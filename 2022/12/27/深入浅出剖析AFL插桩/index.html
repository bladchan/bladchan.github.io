

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/image/favicon.png">
  <link rel="icon" href="/image/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="bladchan">
  <meta name="keywords" content="">
  
    <meta name="description" content="AFLæ’æ¡©å‰–æI. å‰ç½®çŸ¥è¯† ç¼–è¯‘å™¨äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶çš„æµç¨‹å¦‚ä¸‹å›¾1ã€2æ‰€ç¤ºï¼ˆä»¥gccç¼–è¯‘å™¨ä¸ºä¾‹ï¼ŒclangåŒç†ï¼‰ï¼š   å›¾1 gccç¼–è¯‘å™¨å·¥ä½œæµç¨‹ï¼ˆé¡¶å±‚æ¶æ„ï¼‰   å›¾2 clangç¼–è¯‘å™¨å·¥ä½œæµç¨‹ï¼ˆé¡¶å±‚æ¶æ„ï¼‰   ä¸»æµçš„ç¼–è¯‘å™¨ã€å›¾1ä¸­ç¬¬äºŒä¸ªé˜¶æ®µã€‘åŒ…æ‹¬ä¸‰ä¸ªç»„ä»¶ï¼šå‰ç«¯ã€ä¸­é—´ç«¯å’Œåç«¯ [1] å‰ç«¯ï¼šè¯»å–æºæ–‡ä»¶å¹¶å¯¹å…¶è¿›è¡Œåˆ†æï¼Œé€šå¸¸æ˜¯å°†æºç è½¬åŒ–ä¸ºæ ‡å‡†æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ ä¸­é—´ç«¯ï¼šè¿›è¡Œæºç ä¼˜åŒ–ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ç”Ÿæˆçš„æŸ">
<meta property="og:type" content="article">
<meta property="og:title" content="æ·±å…¥æµ…å‡ºAFLæ’æ¡©">
<meta property="og:url" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/index.html">
<meta property="og:site_name" content="chan&#39;s blog">
<meta property="og:description" content="AFLæ’æ¡©å‰–æI. å‰ç½®çŸ¥è¯† ç¼–è¯‘å™¨äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶çš„æµç¨‹å¦‚ä¸‹å›¾1ã€2æ‰€ç¤ºï¼ˆä»¥gccç¼–è¯‘å™¨ä¸ºä¾‹ï¼ŒclangåŒç†ï¼‰ï¼š   å›¾1 gccç¼–è¯‘å™¨å·¥ä½œæµç¨‹ï¼ˆé¡¶å±‚æ¶æ„ï¼‰   å›¾2 clangç¼–è¯‘å™¨å·¥ä½œæµç¨‹ï¼ˆé¡¶å±‚æ¶æ„ï¼‰   ä¸»æµçš„ç¼–è¯‘å™¨ã€å›¾1ä¸­ç¬¬äºŒä¸ªé˜¶æ®µã€‘åŒ…æ‹¬ä¸‰ä¸ªç»„ä»¶ï¼šå‰ç«¯ã€ä¸­é—´ç«¯å’Œåç«¯ [1] å‰ç«¯ï¼šè¯»å–æºæ–‡ä»¶å¹¶å¯¹å…¶è¿›è¡Œåˆ†æï¼Œé€šå¸¸æ˜¯å°†æºç è½¬åŒ–ä¸ºæ ‡å‡†æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ ä¸­é—´ç«¯ï¼šè¿›è¡Œæºç ä¼˜åŒ–ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ç”Ÿæˆçš„æŸ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/1.png">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/2.png">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/4.png">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/5.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/3.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/270b.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f330.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/270b.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f330.png?v8">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/6.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/7.png">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/8.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/9.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/10.png">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/11.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png?v8">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/12.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f4d3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f4ad.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/270b.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/2753.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/13.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8">
<meta property="og:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/14.png">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8">
<meta property="og:image" content="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8">
<meta property="article:published_time" content="2022-12-27T09:55:00.000Z">
<meta property="article:modified_time" content="2023-05-01T09:00:42.174Z">
<meta property="article:author" content="bladchan">
<meta property="article:tag" content="æ¨¡ç³Šæµ‹è¯•">
<meta property="article:tag" content="AFL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://bladchan.github.io/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/1.png">
  
  
  
  <title>æ·±å…¥æµ…å‡ºAFLæ’æ¡© - chan&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"bladchan.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Chan&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>å‹é“¾</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="æ·±å…¥æµ…å‡ºAFLæ’æ¡©"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-27 17:55" pubdate>
          2022å¹´12æœˆ27æ—¥ ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          31k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          260 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">æ·±å…¥æµ…å‡ºAFLæ’æ¡©</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="AFLæ’æ¡©å‰–æ"><a href="#AFLæ’æ¡©å‰–æ" class="headerlink" title="AFLæ’æ¡©å‰–æ"></a>AFLæ’æ¡©å‰–æ</h1><h2 id="I-å‰ç½®çŸ¥è¯†"><a href="#I-å‰ç½®çŸ¥è¯†" class="headerlink" title="I. å‰ç½®çŸ¥è¯†"></a>I. å‰ç½®çŸ¥è¯†</h2><ul>
<li>ç¼–è¯‘å™¨äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶çš„æµç¨‹å¦‚ä¸‹å›¾1ã€2æ‰€ç¤ºï¼ˆä»¥gccç¼–è¯‘å™¨ä¸ºä¾‹ï¼ŒclangåŒç†ï¼‰ï¼š</li>
</ul>
<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/1.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾1 gccç¼–è¯‘å™¨å·¥ä½œæµç¨‹ï¼ˆé¡¶å±‚æ¶æ„ï¼‰</center>

<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/2.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾2 clangç¼–è¯‘å™¨å·¥ä½œæµç¨‹ï¼ˆé¡¶å±‚æ¶æ„ï¼‰</center>

<ul>
<li>ä¸»æµçš„ç¼–è¯‘å™¨ã€å›¾1ä¸­ç¬¬äºŒä¸ªé˜¶æ®µã€‘åŒ…æ‹¬ä¸‰ä¸ªç»„ä»¶ï¼š<strong>å‰ç«¯</strong>ã€<strong>ä¸­é—´ç«¯</strong>å’Œ<strong>åç«¯</strong> [1]<ul>
<li>å‰ç«¯ï¼šè¯»å–æºæ–‡ä»¶å¹¶å¯¹å…¶è¿›è¡Œåˆ†æï¼Œé€šå¸¸æ˜¯å°†æºç è½¬åŒ–ä¸ºæ ‡å‡†æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰</li>
<li>ä¸­é—´ç«¯ï¼šè¿›è¡Œæºç ä¼˜åŒ–ï¼Œé€šå¸¸æ˜¯ä½¿ç”¨ç”Ÿæˆçš„æŸç§ä¸­é—´è¡¨ç¤ºã€GCCä¸­æ˜¯GIMPLE/RTLï¼›Clangä¸­æ˜¯IRã€‘ï¼Œå¹¶æ ¹æ®è¯¥ä¸­é—´è¡¨ç¤ºè¿›è¡Œä¼˜åŒ–</li>
<li>åç«¯ï¼šä½¿ç”¨ä¼˜åŒ–åçš„ä¸­é—´è¡¨ç¤ºæ¥ç”Ÿæˆå¯¹åº”ç›®æ ‡æ¶æ„çš„æ±‡ç¼–ä»£ç </li>
</ul>
</li>
</ul>
<h3 id="1-GCC"><a href="#1-GCC" class="headerlink" title="1. GCC"></a>1. GCC</h3><ul>
<li>GCC 4.1æ¶æ„å›¾ï¼š</li>
</ul>
<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/4.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾3 GCC 4.1æ¶æ„å›¾</center>

<h4 id="å››ä¸ªé˜¶æ®µ"><a href="#å››ä¸ªé˜¶æ®µ" class="headerlink" title="å››ä¸ªé˜¶æ®µ"></a>å››ä¸ªé˜¶æ®µ</h4><p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/5.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾4 ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é“¾æ¥æ—¶çš„å…·ä½“æµç¨‹[8]</center>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gcc -E afl_inst_test.c <span class="hljs-comment"># é¢„å¤„ç†</span><br>$ gcc -S afl_inst_test.c <span class="hljs-comment"># ç¼–è¯‘</span><br>$ gcc -c afl_inst_test.c <span class="hljs-comment"># æ±‡ç¼– =&gt; ç›®æ ‡æ–‡ä»¶ or as afl_inst_test.s -o afl_inst_test.o</span><br>$ ld -plugin /usr/lib/gcc/x86_64-linux-gnu/7/liblto_plugin.so -plugin-opt=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper -plugin-opt=-fresolution=/tmp/cclTw8TB.res -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lgcc_s --build-id --eh-frame-hdr -m elf_x86_64 --hash-style=gnu --as-needed -dynamic-linker /lib64/ld-linux-x86-64.so.2 -pie -z now -z relro /usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/Scrt1.o /usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/7/crtbeginS.o -L/usr/lib/gcc/x86_64-linux-gnu/7 -L/usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/7/../../../../lib -L/lib/x86_64-linux-gnu -L/lib/../lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-linux-gnu/7/../../.. ./afl_inst_test.o -lgcc --push-state --as-needed -lgcc_s --pop-state -lc -lgcc --push-state --as-needed -lgcc_s --pop-state /usr/lib/gcc/x86_64-linux-gnu/7/crtendS.o /usr/lib/gcc/x86_64-linux-gnu/7/../../../x86_64-linux-gnu/crtn.o -o afl_inst_test <span class="hljs-comment"># é“¾æ¥ï¼[10]</span><br>$ afl_inst_test<br>This is a <span class="hljs-built_in">test</span>!<br>Please give me an input number:-1<br>-1 is a negative number~<br></code></pre></td></tr></tbody></table></figure>

<h4 id="å‰ç«¯åˆ†æ"><a href="#å‰ç«¯åˆ†æ" class="headerlink" title="å‰ç«¯åˆ†æ"></a>å‰ç«¯åˆ†æ</h4><ul>
<li><p>å¯¹æºä»£ç è¿›è¡Œ<strong>é¢„å¤„ç†</strong>ã€<strong>è¯­æ³•åˆ†æ</strong>ã€<strong>è¯­ä¹‰åˆ†æ</strong>ï¼ŒåŒæ—¶ä¼šç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘<strong>AST</strong></p>
</li>
<li><p>parse the source code  <span class="github-emoji"><span>â¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>  å³å°†æºä»£ç è½¬åŒ–ä¸ºæœ‰æ„ä¹‰çš„æ•°æ®ï¼ˆæœ‰æ„ä¹‰æ˜¯é’ˆå¯¹æœºå™¨æ¥è¯´çš„ï¼‰ï¼Œè¡¨ç¤ºæˆ‘ä»¬å¯è¯»çš„æºä»£ç ç©¶ç«Ÿæƒ³è¦è¡¨è¾¾å•¥</p>
</li>
</ul>
<hr>
<p><span class="github-emoji"><span>ğŸ¤”</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <strong>GCCæœ¬èº«æ— æ³•è¾“å‡ºç”Ÿæˆçš„AST [2]ï¼Œè¿™é‡Œæˆ‘ä»¬å±•ç¤ºGCCç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆçš„CFG [3]</strong> ï¼š</p>
<ol start="0">
<li>æºä»£ç ï¼š</li>
</ol>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// afl_inst_test.c</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">fun</span><span class="hljs-params">(<span class="hljs-type">int</span> a)</span>{<br>	<span class="hljs-keyword">if</span>(a &gt; <span class="hljs-number">0</span>){<br>		<span class="hljs-keyword">return</span> -a;<br>	}<br>	<span class="hljs-keyword">return</span> a;<br>}<br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span>** argv)</span>{<br>	<span class="hljs-type">int</span> a;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"This is a test!\nPlease give me an input number:"</span>);<br>	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a);<br>	<span class="hljs-comment">/* simulating branches */</span><br>	<span class="hljs-keyword">if</span>(a &gt; <span class="hljs-number">0</span>){<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d is a positive number~"</span>, a);	<br>	}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(a &lt; <span class="hljs-number">0</span>){<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d is a negative number~"</span>, a);	<br>	}<span class="hljs-keyword">else</span> {<br>		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"zero detected!"</span>);<br>	}<br>	<span class="hljs-comment">/* simulating a function call */</span><br>	fun(a);<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>

<ol>
<li>äº§ç”ŸASTå¯¹åº”çš„<code>.dot</code>æ–‡ä»¶ï¼š</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gcc afl_inst_test.c -fdump-tree-all-graph<br>$ <span class="hljs-built_in">ls</span><br>afl_inst_test.c<br>afl_inst_test.c.001t.tu<br>afl_inst_test.c.002t.class<br>afl_inst_test.c.003t.original<br>...<br>afl_inst_test.c.227t.optimized<br>afl_inst_test.c.227t.optimized.dot<br>afl_inst_test.c.311t.statistics<br>a.out<br></code></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>ä½¿ç”¨<code>dot</code>ç¨‹åºå°†mainå‡½æ•°å¯¹åº”<code>.dot</code>è½¬åŒ–ä¸ºå¯è§†å›¾ï¼š</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ dot -Tpng afl_inst_test.c.011t.cfg.dot -o main.png<br></code></pre></td></tr></tbody></table></figure>

<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/3.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾5 ç¤ºä¾‹CFG</center>

<h4 id="ä¸­é—´ç«¯ä¼˜åŒ–"><a href="#ä¸­é—´ç«¯ä¼˜åŒ–" class="headerlink" title="ä¸­é—´ç«¯ä¼˜åŒ–"></a>ä¸­é—´ç«¯ä¼˜åŒ–</h4><ul>
<li>GCCä¸­é—´ç«¯åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š<strong>GIMPLE</strong> å’Œ <strong>RTL</strong></li>
</ul>
<hr>
<p><strong>GIMPLEï¼š</strong></p>
<ul>
<li><p>æ´¾ç”Ÿè‡ªGCC <strong>GENERIC</strong>ï¼ˆä¹Ÿæ˜¯ä¸€ç§ä¸­é—´è¡¨ç¤ºï¼›æœ€åˆï¼Œä¸åŒçš„GCCå‰ç«¯ä¼šç”Ÿæˆä¾èµ–äºæ¶æ„çš„æ ‘è¡¨ç¤ºï¼Œè€ŒGENERICæ˜¯ä½œä¸ºä¸å¹³å°æ— å…³çš„æ ‘è¡¨ç¤ºè€Œå¼•å…¥çš„ï¼Œä»¥ç®€åŒ–å‰ç«¯å¼€å‘è¿‡ç¨‹ã€‚<strong>GENERIC</strong>çš„ç›®æ ‡æ˜¯ç”Ÿæˆ<strong>GIMPLE</strong> [5]ï¼‰</p>
</li>
<li><p>three-addressè¡¨ç¤ºï¼š</p>
<ul>
<li>å°†<strong>GENERIC</strong>è¡¨è¾¾å¼æ‹†æˆä¸è¶…è¿‡3ä¸ªæ“ä½œæ•°çš„å…ƒç»„ï¼ˆé™¤äº†å‡½æ•°è°ƒç”¨ï¼‰</li>
</ul>
</li>
<li><p>å¼•å…¥<strong>æš‚å­˜å™¨</strong>æ¥ä¿å­˜è®¡ç®—å¤æ‚è¡¨è¾¾å¼æ‰€éœ€çš„ä¸­é—´å€¼ï¼ŒGENERICä¸­ä½¿ç”¨çš„æ§åˆ¶ç»“æ„é™çº§ä¸º<strong>æ¡ä»¶è·³è½¬</strong>ï¼Œè¯æ³•<strong>ä½œç”¨åŸŸè¢«ç§»é™¤</strong>ï¼Œè€Œå¼‚å¸¸åŒºåŸŸåˆ™è¢«è½¬æ¢ä¸ºè¾¹ä¸Šçš„å¼‚å¸¸åŒºåŸŸæ ‘</p>
</li>
<li><p>ä½¿ç”¨ä¸€ä¸ªâ€gimplifierâ€å°†<strong>GENERIC</strong>è½¬åŒ–ä¸º<strong>GIMPLE</strong></p>
</li>
<li><p>åŒ…æ‹¬â€<strong>High GIMPLE</strong>â€œå’Œâ€<strong>Low GIMPLE</strong>â€œ</p>
<ul>
<li>High GIMPLEåŒ…å«ä¸€äº›å®¹å™¨è¯­å¥ï¼Œå¦‚è¯æ³•èŒƒå›´å’ŒåµŒå¥—è¡¨è¾¾å¼ï¼Œæ´¾ç”Ÿè‡ª<strong>å‰ç«¯ASTæ ‘</strong>æˆ–<strong>GENERIC</strong>ï¼Œç„¶ååŸºäºHigh GIMPLEç”ŸæˆLow GIMPLE</li>
<li>Low GIMPLEåˆ™æ˜¾ç¤ºæ‰€æœ‰æ§åˆ¶å’Œå¼‚å¸¸è¡¨è¾¾å¼çš„éšå«è·³è½¬</li>
</ul>
</li>
<li><p>Cå’ŒC++å‰ç«¯ç›´æ¥ä»å‰ç«¯ASTæ ‘è½¬åŒ–ä¸º<strong>GIMPLE</strong>ï¼Œè€Œä¸æ˜¯è½¬åŒ–ä¸º<strong>GENERIC</strong></p>
</li>
<li><p>ä½¿ç”¨æ ‡å¿—<code>-fdump-tree-gimple</code>æ¥ç”Ÿæˆç±»Cçš„è¡¨ç¤º</p>
</li>
</ul>
<p><span class="github-emoji"><span>âœ‹</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/270b.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è¯´ç™½äº†ï¼Œ<strong>GIMPLE</strong>å°±æ˜¯å¹²äº†ä¸¤ä»¶äº‹ï¼š</p>
<p>â€‹	<span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ é™¤é«˜çº§ç»“æ„ï¼Œå¦‚forï¼Œwhileå¾ªç¯ã€ç”¨gotoå’Œè·³è½¬æ›¿æ¢ã€‘</p>
<p>â€‹	<span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç®€åŒ–è¡¨è¾¾å¼ï¼ˆé€šè¿‡å¼•å…¥ä¸´æ—¶å˜é‡ï¼‰</p>
<p><span class="github-emoji"><span>âš </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å¯ä»¥åœ¨Low GIMPLEå®ç°GIMPLEå±‚çº§çš„Passï¼</p>
<p><span class="github-emoji"><span>ğŸŒ°</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f330.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code> if (a || b) stmt;</code>  ==&gt;</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-keyword">if</span> (a) <span class="hljs-keyword">goto</span> L1;<br><span class="hljs-keyword">if</span> (b) <span class="hljs-keyword">goto</span> L1; <span class="hljs-keyword">else</span> <span class="hljs-keyword">goto</span> L2;<br>L1:<br>stmt;<br>L2:<br></code></pre></td></tr></tbody></table></figure>

<hr>
<p><strong>GCCç”ŸæˆGIMPLE</strong>ï¼š</p>
<p>Low GIMPLE:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gcc afl_inst_test.c -fdump-tree-gimple<br>$ <span class="hljs-built_in">cat</span> afl_inst_test.c.004t.gimple <br>fun (int a)<br>{<br>  int D.2258;<br><br>  <span class="hljs-keyword">if</span> (a &gt; 0) goto &lt;D.2256&gt;; <span class="hljs-keyword">else</span> goto &lt;D.2257&gt;;<br>  &lt;D.2256&gt;:<br>  D.2258 = -a;<br>  <span class="hljs-built_in">return</span> D.2258;<br>  &lt;D.2257&gt;:<br>  D.2258 = a;<br>  <span class="hljs-built_in">return</span> D.2258;<br>}<br>...<br></code></pre></td></tr></tbody></table></figure>

<p>High GIMPLE:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gcc afl_inst_test.c -fdump-tree-gimple-raw<br>$ <span class="hljs-built_in">cat</span> afl_inst_test.c.004t.gimple<br>fun (int a)<br>gimple_bind &lt;<br>  int D.2258;<br><br>  gimple_cond &lt;gt_expr, a, 0, &lt;D.2256&gt;, &lt;D.2257&gt;&gt;<br>  gimple_label &lt;&lt;<span class="hljs-string">D.2256&gt;&gt;</span><br><span class="hljs-string">  gimple_assign &lt;negate_expr, D</span>.2258, a, NULL, NULL&gt;<br>  gimple_return &lt;D.2258 NULL&gt;<br>  gimple_label &lt;&lt;<span class="hljs-string">D.2257&gt;&gt;</span><br><span class="hljs-string">  gimple_assign &lt;parm_decl, D</span>.2258, a, NULL, NULL&gt;<br>  gimple_return &lt;D.2258 NULL&gt;<br>&gt;<br>...<br></code></pre></td></tr></tbody></table></figure>

<hr>
<p><strong>RTL:</strong></p>
<ul>
<li>å¯„å­˜å™¨è½¬æ¢è¯­è¨€ <em>Register Transfer Language</em>ï¼Œä¸æ±‡ç¼–è¯­è¨€å¾ˆæ¥è¿‘</li>
<li>è¡¨ç¤ºä¸€ä¸ªå…·æœ‰æ— é™æ•°é‡å¯„å­˜å™¨çš„æŠ½è±¡æœºå™¨ï¼Œç»“æ„ç±»ä¼¼äºLispå’ŒCè¯­è¨€çš„æ··åˆ</li>
<li>åœ¨ç”Ÿæˆ<strong>RTL</strong>ä»£ç åï¼ŒGCCç¼–è¯‘å™¨åœ¨å°†å…¶è½¬æ¢åˆ°æ±‡ç¼–è¯­è¨€ä¹‹å‰è¿›è¡Œäº†ä¸åŒçš„<strong>åº•å±‚ä¼˜åŒ–</strong> [7]</li>
<li>ç”±äº<strong>RTL</strong>è¡¨ç¤ºçš„ç”Ÿæˆå’Œä¼˜åŒ–çš„ç¨‹åºåœ¨ç¼–è¯‘è¿‡ç¨‹çš„åç«¯ï¼Œè¿™æ„å‘³ç€å®ƒä¾èµ–äºç¡¬ä»¶ï¼Œè€Œä¸åŒ…å«ç¨‹åºçš„æ‰€æœ‰ä¿¡æ¯</li>
</ul>
<p><span class="github-emoji"><span>âœ‹</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/270b.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è¯´ç™½äº†ï¼Œ<strong>RTL</strong>å°±æ˜¯å¹²äº†ä¸¤ä»¶äº‹ï¼š</p>
<p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å°†<strong>GIMPLE</strong>è½¬åŒ–ä¸ºä¸ç¡¬ä»¶ç›¸å…³çš„RTLè¯­è¨€</p>
<p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åœ¨RTLåŸºç¡€ä¸Šè¿›è¡Œ<strong>åº•å±‚ä¼˜åŒ–</strong></p>
<p><span class="github-emoji"><span>âš </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®ç°åŸºäºRTLå±‚çº§çš„Passï¼</p>
<p><span class="github-emoji"><span>ğŸŒ°</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f330.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>b = a - 1</code>  ==&gt;</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(set (reg/v:SI 59 [ b ])<br>     (plus:SI (reg/v:SI 60 [ a ]<br>              (const_int -1 [0xffffffff]))))<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>RTLä¸­çš„ä¸€äº›ä¼˜åŒ–Passesï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>Name</th>
</tr>
</thead>
<tbody><tr>
<td>RTL generation</td>
</tr>
<tr>
<td>Loop optimization</td>
</tr>
<tr>
<td>Jump bypassing</td>
</tr>
<tr>
<td>If conversion</td>
</tr>
<tr>
<td>Instruction combination</td>
</tr>
<tr>
<td>Register movement</td>
</tr>
<tr>
<td>Instruction scheduling</td>
</tr>
<tr>
<td>Register allocation</td>
</tr>
<tr>
<td>Final</td>
</tr>
</tbody></table>
<hr>
<p><strong>GCCç”ŸæˆRTLï¼š</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gcc afl_inst_test.c -fdump-rtl-all<br>$ <span class="hljs-built_in">cat</span> afl_inst_test.c.310r.dfinish <br><br>;; Function fun (fun, funcdef_no=0, decl_uid=2248, cgraph_uid=0, symbol_order=0)<br><br>(note 1 0 4 NOTE_INSN_DELETED)<br>(note 4 1 28 2 [bb 2] NOTE_INSN_BASIC_BLOCK)<br>(insn/f 28 4 29 2 (<span class="hljs-built_in">set</span> (mem:DI (pre_dec:DI (reg/f:DI 7 sp)) [0  S8 A8])<br>        (reg/f:DI 6 bp)) <span class="hljs-string">"afl_inst_test.c"</span>:3 57 {*pushdi2_rex64}<br>     (nil))<br>(insn/f 29 28 30 2 (<span class="hljs-built_in">set</span> (reg/f:DI 6 bp)<br>        (reg/f:DI 7 sp)) <span class="hljs-string">"afl_inst_test.c"</span>:3 81 {*movdi_internal}<br>     (nil))<br>...<br></code></pre></td></tr></tbody></table></figure>

<h4 id="åç«¯ç”Ÿæˆ"><a href="#åç«¯ç”Ÿæˆ" class="headerlink" title="åç«¯ç”Ÿæˆ"></a>åç«¯ç”Ÿæˆ</h4><ul>
<li>åç«¯ä¸ºæŒ‡å®šçš„ç›®æ ‡å¹³å°ç”Ÿæˆæ±‡ç¼–ä»£ç </li>
</ul>
<p>GCCç”Ÿæˆç›®æ ‡å¹³å°æ±‡ç¼–ä»£ç ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ gcc -S afl_inst_test.c<br>$ <span class="hljs-built_in">cat</span> afl_inst_test.s<br></code></pre></td></tr></tbody></table></figure>

<h3 id="2-Clang"><a href="#2-Clang" class="headerlink" title="2. Clang"></a>2. Clang</h3><h4 id="å››ä¸ªé˜¶æ®µ-1"><a href="#å››ä¸ªé˜¶æ®µ-1" class="headerlink" title="å››ä¸ªé˜¶æ®µ"></a>å››ä¸ªé˜¶æ®µ</h4><ul>
<li>ä¸GCCç±»ä¼¼ï¼Œä¸å†èµ˜è¿°</li>
</ul>
<h4 id="å‰ç«¯åˆ†æ-1"><a href="#å‰ç«¯åˆ†æ-1" class="headerlink" title="å‰ç«¯åˆ†æ"></a>å‰ç«¯åˆ†æ</h4><ul>
<li>Clang<strong>å‰ç«¯ç®¡çº¿</strong>ï¼š</li>
</ul>
<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/6.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾6 Clangå‰ç«¯æµæ°´çº¿</center>

<p><strong>é¢„å¤„ç†</strong>ï¼š</p>
<ul>
<li>C/C++é¢„å¤„ç†å™¨åœ¨<strong>è¯æ³•åˆ†æä¹‹å‰</strong>æ‰§è¡Œï¼Œä¸»è¦åŠŸèƒ½æ˜¯<ul>
<li>å±•å¼€å®</li>
<li>å±•å¼€åŒ…å«æ–‡ä»¶</li>
<li>æ ¹æ®å„ç§ä»¥#å¼€å¤´çš„é¢„å¤„ç†å™¨æŒ‡ç¤ºç•¥å»éƒ¨åˆ†ä»£ç </li>
</ul>
</li>
</ul>
<hr>
<p><strong>è¯æ³•åˆ†æï¼š</strong></p>
<ul>
<li>å¤„ç†æºä»£ç çš„æ–‡æœ¬è¾“å…¥ï¼Œå°†è¯­è¨€ç»“æ„åˆ†è§£ä¸ºä¸€ç»„å•è¯å’Œæ ‡è®°ï¼Œå»é™¤æ³¨é‡Šã€ç©ºç™½ã€åˆ¶è¡¨ç¬¦ç­‰</li>
<li>clangè¯æ³•åˆ†æè¾“å‡ºç»“æœï¼š</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ clang -cc1 -dump-tokens afl_inst_test.c<br>...<br></code></pre></td></tr></tbody></table></figure>

<p>ä¾‹å¦‚ï¼Œåœ¨<code>fun()</code>[Line 4-6] å‡½æ•°å†…çš„ifè¯­å¥é«˜äº®è¾“å‡ºæ˜¯ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span> <span class="hljs-string">'if'</span>	 [StartOfLine] [LeadingSpace]	Loc=&lt;afl_inst_test.c:<span class="hljs-number">4</span>:<span class="hljs-number">2</span>&gt;<br>l_paren <span class="hljs-string">'('</span>		Loc=&lt;afl_inst_test.c:<span class="hljs-number">4</span>:<span class="hljs-number">4</span>&gt;<br>identifier <span class="hljs-string">'a'</span>		Loc=&lt;afl_inst_test.c:<span class="hljs-number">4</span>:<span class="hljs-number">5</span>&gt;<br>greater <span class="hljs-string">'&gt;'</span>	 [LeadingSpace]	Loc=&lt;afl_inst_test.c:<span class="hljs-number">4</span>:<span class="hljs-number">7</span>&gt;<br>numeric_constant <span class="hljs-string">'0'</span>	 [LeadingSpace]	Loc=&lt;afl_inst_test.c:<span class="hljs-number">4</span>:<span class="hljs-number">9</span>&gt;<br>r_paren <span class="hljs-string">')'</span>		Loc=&lt;afl_inst_test.c:<span class="hljs-number">4</span>:<span class="hljs-number">10</span>&gt;<br>l_brace <span class="hljs-string">'{'</span>		Loc=&lt;afl_inst_test.c:<span class="hljs-number">4</span>:<span class="hljs-number">11</span>&gt;<br><span class="hljs-keyword">return</span> <span class="hljs-string">'return'</span>	 [StartOfLine] [LeadingSpace]	Loc=&lt;afl_inst_test.c:<span class="hljs-number">5</span>:<span class="hljs-number">3</span>&gt;<br>minus <span class="hljs-string">'-'</span>	 [LeadingSpace]	Loc=&lt;afl_inst_test.c:<span class="hljs-number">5</span>:<span class="hljs-number">10</span>&gt;<br>identifier <span class="hljs-string">'a'</span>		Loc=&lt;afl_inst_test.c:<span class="hljs-number">5</span>:<span class="hljs-number">11</span>&gt;<br>semi <span class="hljs-string">';'</span>		Loc=&lt;afl_inst_test.c:<span class="hljs-number">5</span>:<span class="hljs-number">12</span>&gt;<br>r_brace <span class="hljs-string">'}'</span>	 [StartOfLine] [LeadingSpace]	Loc=&lt;afl_inst_test.c:<span class="hljs-number">6</span>:<span class="hljs-number">2</span>&gt;<br></code></pre></td></tr></tbody></table></figure>

<hr>
<p><strong>è¯­æ³•åˆ†æï¼š</strong></p>
<ul>
<li><p>å°†è¯æ³•åˆ†æäº§ç”Ÿçš„æ ‡è®°æµä½œä¸ºè¾“å‡ºï¼Œè¾“å‡ºè¯­æ³•æ ‘ï¼ˆASTï¼‰</p>
</li>
<li><p>ä¸€ä¸ªASTèŠ‚ç‚¹è¡¨æ˜å£°æ˜ã€è¯­å¥å’Œç±»å‹</p>
</li>
<li><p>è¯­æ³•è§£æå™¨æ¥å—å¹¶å¤„ç†åœ¨è¯æ³•é˜¶æ®µç”Ÿæˆçš„æ ‡è®°åºåˆ—ï¼Œæ¯å½“å‘ç°ä¸€ç»„è¦æ±‚çš„æ ‡è®°åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¼šç”Ÿæˆä¸€ä¸ªASTèŠ‚ç‚¹</p>
<ul>
<li><p>å¦‚æ¯å½“å‘ç°ä¸€ä¸ªæ ‡è®°tok::kw_ifæ—¶ï¼Œå°±ä¼šè°ƒç”¨<code>ParseIfStatement()</code>å‡½æ•°å¤„ç†ifè¯­å¥ä½“ä¸­çš„æ‰€æœ‰æ ‡è®°ï¼Œå¹¶ä¸ºå®ƒä»¬ç”Ÿæˆæ‰€å¿…é¡»çš„å­©å­ASTèŠ‚ç‚¹å’Œä¸€ä¸ªIfStmtæ ¹èŠ‚ç‚¹</p>
</li>
<li><pre><code class="c">// lib/Parse/ParseStmt.cpp
...
  case tok::kw_if:                  // C99 6.8.4.1: if-statement
    return ParseIfStatement(TrailingElseLoc);
  case tok::kw_switch:              // C99 6.8.4.2: switch-statement
    return ParseSwitchStatement(TrailingElseLoc);
...
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><br><span class="hljs-bullet">* </span>Clangå¹¶ä¸åœ¨è§£æä¹‹åéå†ASTï¼Œè€Œæ˜¯åœ¨ASTèŠ‚ç‚¹ç”Ÿæˆè¿‡ç¨‹ä¸­å³æ—¶æ£€æŸ¥ç±»å‹<br><br><span class="hljs-bullet">* </span>è¯­æ³•åˆ†æ<span class="hljs-strong">**è¯†åˆ«è§£æé”™è¯¯**</span><br><br><span class="hljs-bullet">* </span>Clangç”Ÿæˆ<span class="hljs-strong">**AST**</span>æ ‘ï¼š<br><br><span class="hljs-code">```bash</span><br><span class="hljs-code">$ clang -fsyntax-only -Xclang -ast-dump afl_inst_test.c</span><br><span class="hljs-code"># or clang -cc1 -ast-dump afl_inst_test.c [9]</span><br></code></pre></td></tr></tbody></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><p>ASTæ ‘çš„å¯è§†åŒ–ç•Œé¢ï¼š</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ clang -fsyntax-only -Xclang -ast-view afl_inst_test.c<br></code></pre></td></tr></tbody></table></figure>

<hr>
<p><strong>ç”ŸæˆLLVM IR</strong></p>
<ul>
<li><p>ç»è¿‡è¯æ³•åˆ†æå’Œè¯­ä¹‰åˆ†æçš„è”åˆå¤„ç†ä¹‹åï¼ŒClangä¼šè°ƒç”¨<code>CodeGenAction()</code>ç¼–è¯‘<strong>AST</strong>ä»¥ç”Ÿæˆ<strong>LLVM IR</strong></p>
</li>
<li><p>å‰ç«¯æµæ°´çº¿ç»“æŸï¼</p>
</li>
</ul>
<h4 id="ä¸­é—´ç«¯ä¼˜åŒ–-11"><a href="#ä¸­é—´ç«¯ä¼˜åŒ–-11" class="headerlink" title="ä¸­é—´ç«¯ä¼˜åŒ–[11]"></a>ä¸­é—´ç«¯ä¼˜åŒ–<sup>[11]</sup></h4><ul>
<li><p>LLVMä¸­é—´è¡¨ç¤ºIRæ˜¯è¿æ¥å‰ç«¯å’Œåç«¯çš„ä¸­æ¢ï¼Œè®©LLVMèƒ½å¤Ÿè§£æå¤šç§æºè¯­è¨€ï¼Œä¸ºå¤šç§ç›®æ ‡ç”Ÿæˆä»£ç </p>
</li>
<li><p>å‰ç«¯äº§ç”ŸIRï¼Œåç«¯ä¹Ÿæ¥æ”¶IR</p>
</li>
<li><p>å¼•å…¥IRçš„å‡ºå‘ç‚¹ï¼š<span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è§£å†³ä¸åŒè¯­è¨€æºä»£ç çš„å·®å¼‚æ€§ï¼› <span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾¿äºç”Ÿæˆä¸åŒå¹³å°ç›¸å¼‚çš„æœºå™¨æŒ‡ä»¤é›†</p>
<ul>
<li>é€šç”¨æ€§</li>
<li>é«˜çº§IRèƒ½å¤Ÿè®©ä¼˜åŒ–å™¨è½»æ¾æç‚¼å‡ºåŸå§‹æºä»£ç çš„æ„å›¾ï¼›ä½çº§IRè®©ç¼–è¯‘å™¨èƒ½å¤Ÿæ›´å®¹æ˜“ç”Ÿæˆä¸ºç‰¹å®šç¡¬ä»¶ä¼˜åŒ–çš„ä»£ç </li>
</ul>
</li>
<li><p>IRçš„ä¸‰ç§ç­‰ä»·å½¢å¼ï¼š</p>
<ul>
<li>é©»ç•™å†…å­˜çš„è¡¨ç¤ºï¼ˆæŒ‡ä»¤ç±»ç­‰ï¼‰</li>
<li>ç£ç›˜ä¸Šä»¥ç©ºé—´é«˜æ•ˆæ–¹å¼ç¼–ç çš„ä½è¡¨ç¤ºï¼ˆbitcodeæ–‡ä»¶ï¼‰</li>
<li>ç£ç›˜ä¸Šçš„äººç±»å¯è¯»æ–‡æœ¬è¡¨ç¤ºï¼ˆLLVMæ±‡ç¼–æ–‡ä»¶ï¼‰</li>
</ul>
</li>
<li><p>IRçš„å·¥ä½œæµå›¾ï¼š</p>
</li>
</ul>
<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/7.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾7 LLVM IRå·¥ä½œæµå›¾</center>

<hr>
<p><strong>Clangç”ŸæˆIRï¼š</strong></p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// sum.c</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {<br>  <span class="hljs-keyword">return</span> a+b;<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>ç”Ÿæˆbitcodeï¼š</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ clang sum.c -emit-llvm -c -o sum.bc<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>ç”Ÿæˆæ±‡ç¼–è¡¨ç¤ºï¼š</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ clang sum.c -emit-llvm -S -c -o sum.ll<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>æ±‡ç¼–LLVM IRæ±‡ç¼–æ–‡æœ¬ä»¥ç”Ÿæˆbitcodeï¼š</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ llvm-as sum.ll -o sum.bc<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>åç¼–è¯‘bitcodeä¸ºIRæ±‡ç¼–ï¼š</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ llvm-dis sum.bc -o sum.ll<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>llvm-extractå·¥å…·æå–IRå‡½æ•°ã€å…¨å±€å˜é‡ï¼Œè¿˜èƒ½ä»IRæ¨¡å—ä¸­åˆ é™¤å…¨å±€å˜é‡ï¼š</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ llvm-extract -func=<span class="hljs-built_in">sum</span> sum.bc -o sum-fn.bc<br></code></pre></td></tr></tbody></table></figure>

<h4 id="åç«¯ç”Ÿæˆ-12"><a href="#åç«¯ç”Ÿæˆ-12" class="headerlink" title="åç«¯ç”Ÿæˆ[12]"></a>åç«¯ç”Ÿæˆ<sup>[12]</sup></h4><ul>
<li>åç«¯ä¸»è¦çš„æ­¥éª¤å°±æ˜¯å°†LLVM IRè½¬æ¢ä¸ºç›®æ ‡æ±‡ç¼–ä»£ç ï¼Œå…·ä½“æ­¥éª¤å¦‚å›¾8æ‰€ç¤ºï¼š</li>
</ul>
<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/8.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾8 LLVM IRåˆ°ç›®æ ‡æ±‡ç¼–ä»£ç çš„æµç¨‹</center>

<ul>
<li><p>ç®€è¦æè¿°ä¸Šè¿°ä»£ç ç”Ÿæˆçš„å„ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><p><strong>æŒ‡ä»¤é€‰æ‹©</strong>ï¼ˆinstruction selectionï¼‰ï¼š</p>
<p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å°†å†…å­˜ä¸­çš„IRè¡¨ç¤ºå˜æ¢ä¸ºç›®æ ‡ç‰¹å®šçš„selectionDAGèŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªDAGè¡¨ç¤ºå•ä¸€åŸºæœ¬å—çš„è®¡ç®—</p>
<p>ä½ å¯ä»¥ä½¿ç”¨debugç‰ˆæœ¬çš„llcæ¥ç”ŸæˆselectionDAGèŠ‚ç‚¹ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /llvm-project/build/bin/llc -debug sum.bc <span class="hljs-comment"># è¿™é‡Œä½¿ç”¨debugç‰ˆæœ¬çš„clangï¼</span><br>...<br>SelectionDAG has 18 nodes:<br>  t0: ch = EntryToken<br>  t6: i64 = Constant&lt;0&gt;<br>      t2: i32,ch = CopyFromReg t0, Register:i32 %0<br>    t8: ch = store&lt;ST4[%a.addr]&gt; t0, t2, FrameIndex:i64&lt;0&gt;, undef:i64<br>    t4: i32,ch = CopyFromReg t0, Register:i32 %1<br>  t10: ch = store&lt;ST4[%b.addr]&gt; t8, t4, FrameIndex:i64&lt;1&gt;, undef:i64<br>      t11: i32,ch = load&lt;LD4[%a.addr](dereferenceable)&gt; t10, FrameIndex:i64&lt;0&gt;, undef:i64<br>      t12: i32,ch = load&lt;LD4[%b.addr](dereferenceable)&gt; t10, FrameIndex:i64&lt;1&gt;, undef:i64<br>    t13: i32 = add nsw t11, t12<br>  t16: ch,glue = CopyToReg t10, Register:i32 %eax, t13<br>  t17: ch = X86ISD::RET_FLAG t16, TargetConstant:i32&lt;0&gt;, Register:i32 %eax, t16:1<br>...<br></code></pre></td></tr></tbody></table></figure>

<p>æ­¤å¤–ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ç”ŸæˆselectionDAGå›¾ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /llvm-project/build/bin/llc -view-dag-combine1-dags sum.bc -fast-isel=<span class="hljs-literal">false</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/9.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾9 sumå‡½æ•°çš„SelectionDAGå›¾</center>

<p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ©ç”¨<strong>æ¨¡å¼åŒ¹é…</strong>å°†ç›®æ ‡æ— å…³çš„èŠ‚ç‚¹è½¬æ¢ä¸ºç›®æ ‡ç‰¹å®šçš„èŠ‚ç‚¹ï¼Œè€ŒæŒ‡ä»¤é€‰æ‹©çš„ç®—æ³•æ˜¯å±€éƒ¨çš„ï¼Œæ¯æ¬¡ä½œç”¨SelectionDAGï¼ˆåŸºæœ¬å—ï¼‰çš„å®ä¾‹</p>
<p>å¯ä»¥æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ç”ŸæˆæŒ‡ä»¤é€‰æ‹©åçš„SelectionDAGå›¾ï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /llvm-project/build/bin/llc -view-sched-dags sum.bc -fast-isel=<span class="hljs-literal">false</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/10.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾10 æŒ‡ä»¤é€‰æ‹©åçš„sumå‡½æ•°çš„SelectionDAGå›¾</center>

<p>ç”±ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æŒ‡ä»¤é€‰æ‹©ä¹‹åï¼ŒåŸå…ˆDAGå›¾ä¸­çš„addèŠ‚ç‚¹è¢«æ›¿æ¢æˆADD32rrï¼ŒX86ISD::RET_FLAGè¢«æ›¿æ¢ä¸ºRETï¼Œloadè¢«æ›¿æ¢ä¸ºMOV32rmï¼Œstoreè¢«æ›¿æ¢ä¸ºMOV32mr</p>
</li>
<li><p><strong>æŒ‡ä»¤è°ƒåº¦</strong>ï¼ˆinstruction schedulingï¼‰ï¼š</p>
<ul>
<li>æŒ‡ä»¤å»¶è¿Ÿè¡¨ï¼šæ ¹æ®å…·ä½“ç¡¬ä»¶ä¿¡æ¯æ¥æé«˜æŒ‡ä»¤çº§å¹¶è¡Œï¼Œä»è€Œæé«˜åœ¨è®¡ç®—æœºä¸ŠæŒ‡ä»¤æµæ°´çº¿çš„æ€§èƒ½ [14]</li>
<li>é£é™©æ£€æµ‹ä¸è¯†åˆ«</li>
<li>è°ƒåº¦å•å…ƒ</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /llvm-project/build/bin/llc -view-sunit-dags sum.bc -fast-isel=<span class="hljs-literal">false</span><br></code></pre></td></tr></tbody></table></figure>

<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/11.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾11 è°ƒåº¦å•å…ƒå›¾</center>
</li>
<li><p><strong>å¯„å­˜å™¨åˆ†é…</strong>ï¼ˆRegister allocationï¼‰</p>
<ul>
<li><p>ä½œç”¨åœ¨<strong>æœºå™¨æŒ‡ä»¤</strong>ä¸Šï¼š</p>
<ul>
<li>åœ¨æŒ‡ä»¤è°ƒåº¦ä¹‹åï¼ŒInstrEmitter Passä¼šè¢«è¿è¡Œï¼Œå®ƒå°†<code>SDNode</code>æ ¼å¼è½¬æ¢ä¸º<code>MachineInstr</code>æ ¼å¼</li>
<li>è¯¥è¡¨ç¤ºç›¸è¾ƒäºIRæŒ‡ä»¤æ›´æ¥è¿‘å®é™…çš„ç›®æ ‡æŒ‡ä»¤</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /llvm-project/build/bin/llc -march=sparc -print-machineinstrs sum.bc<br>...<br><span class="hljs-comment"># After Instruction Selection:</span><br><span class="hljs-comment"># Machine code for function sum: IsSSA, TracksLiveness</span><br>Frame Objects:<br>  <span class="hljs-keyword">fi</span><span class="hljs-comment">#0: size=4, align=4, at location [SP]</span><br>  <span class="hljs-keyword">fi</span><span class="hljs-comment">#1: size=4, align=4, at location [SP]</span><br>Function Live Ins: %i0 <span class="hljs-keyword">in</span> %0, %i1 <span class="hljs-keyword">in</span> %1<br><br>%bb.0: derived from LLVM BB %entry<br>    Live Ins: %i0 %i1<br>	%1:intregs = COPY %i1; IntRegs:%1<br>	%0:intregs = COPY %i0; IntRegs:%0<br>	%3:intregs = COPY %1; IntRegs:%3,%1<br>	%2:intregs = COPY %0; IntRegs:%2,%0<br>	STri %stack.0.a.addr, 0, %0; mem:ST4[%a.addr] IntRegs:%0<br>	STri %stack.1.b.addr, 0, %1; mem:ST4[%b.addr] IntRegs:%1<br>	%4:intregs = LDri %stack.0.a.addr, 0; mem:LD4[%a.addr](dereferenceable) IntRegs:%4<br>	%5:intregs = LDri %stack.1.b.addr, 0; mem:LD4[%b.addr](dereferenceable) IntRegs:%5<br>	%6:intregs = ADDrr killed %4, killed %5; IntRegs:%6,%4,%5<br>	%i0 = COPY %6; IntRegs:%6<br>	RETL 8, implicit %i0<br>...<br></code></pre></td></tr></tbody></table></figure>
</li>
<li><p><strong>åŸºæœ¬ä»»åŠ¡ï¼š</strong>å°†æ— é™æ•°é‡çš„è™šæ‹Ÿå¯„å­˜å™¨è½¬æ¢ä¸ºæœ‰é™çš„ç‰©ç†å¯„å­˜å™¨</p>
</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /llvm-project/build/bin/llc -print-after=greedy sum.bc<br><span class="hljs-comment"># *** IR Dump After Greedy Register Allocator ***:</span><br><span class="hljs-comment"># Machine code for function sum: NoPHIs, TracksLiveness</span><br>Frame Objects:<br>  <span class="hljs-keyword">fi</span><span class="hljs-comment">#0: size=4, align=4, at location [SP+8]</span><br>  <span class="hljs-keyword">fi</span><span class="hljs-comment">#1: size=4, align=4, at location [SP+8]</span><br>Function Live Ins: %edi <span class="hljs-keyword">in</span> %0, %esi <span class="hljs-keyword">in</span> %2<br><br>0B	%bb.0: derived from LLVM BB %entry<br>	    Live Ins: %edi %esi<br>16B		%3:gr32 = COPY %esi; GR32:%3<br>32B		%1:gr32 = COPY %edi; GR32:%1<br>80B		MOV32mr %stack.0.a.addr, 1, %noreg, 0, %noreg, %1; mem:ST4[%a.addr] GR32:%1<br>96B		MOV32mr %stack.1.b.addr, 1, %noreg, 0, %noreg, %3; mem:ST4[%b.addr] GR32:%3<br>112B		%7:gr32 = MOV32rm %stack.0.a.addr, 1, %noreg, 0, %noreg; mem:LD4[%a.addr] GR32:%7<br>144B		%7:gr32 = ADD32rm %7, %stack.1.b.addr, 1, %noreg, 0, %noreg, implicit-def dead %eflags; mem:LD4[%b.addr] GR32:%7<br>160B		%eax = COPY %7; GR32:%7<br>176B		RETQ implicit %eax<br><br><span class="hljs-comment"># End machine code for function sum.</span><br><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>å¯„å­˜å™¨åˆå¹¶å™¨ã€è™šæ‹Ÿå¯„å­˜å™¨é‡å†™å’Œç›®æ ‡é’©å­</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="II-AFLå¦‚ä½•è¿›è¡Œæ’æ¡©ï¼Ÿ"><a href="#II-AFLå¦‚ä½•è¿›è¡Œæ’æ¡©ï¼Ÿ" class="headerlink" title="II. AFLå¦‚ä½•è¿›è¡Œæ’æ¡©ï¼Ÿ"></a>II. AFLå¦‚ä½•è¿›è¡Œæ’æ¡©ï¼Ÿ</h2><ul>
<li><p>åŸç”ŸAFLæœ‰<strong>ä¸¤ç§æ’æ¡©æ–¹å¼</strong></p>
<ul>
<li><p>åŸºäºç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–æ–‡ä»¶çš„æ’æ¡©</p>
<ul>
<li>å…³é”®æ–‡ä»¶æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯<code>afl-gcc.c</code>å’Œ<code>afl-as.c</code></li>
<li><code>afl-gcc/g++/clang/clang++/gcj</code>ï¼šç¼–è¯‘å™¨ï¼ˆgccã€clangã€gcjï¼‰çš„ä¸€ä¸ªwrapper <span class="github-emoji"><span>â¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç¼–è¯‘å™¨äº§ç”Ÿæ±‡ç¼–æ–‡ä»¶</li>
<li><code>afl-as</code>ï¼šæ±‡ç¼–å™¨ï¼ˆasï¼‰çš„ä¸€ä¸ªwrapper <span class="github-emoji"><span>â¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/27a1.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å¯¹ç¼–è¯‘å™¨äº§ç”Ÿçš„æ±‡ç¼–æ–‡ä»¶è¿›è¡Œæ’æ¡©ï¼Œç„¶åè°ƒç”¨<code>as</code>ç”Ÿæˆç›®æ ‡æ–‡</li>
</ul>
<p>å›¾è§£ï¼š</p>
<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/12.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾12 åŸºäºç¼–è¯‘å™¨çš„AFLæ’æ¡©æµç¨‹</center>
</li>
<li><p>åŸºäºLLVMæ¨¡å¼çš„æ’æ¡©</p>
<ul>
<li>å…³é”®æ–‡ä»¶å³<code>llvm_mode</code>æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="a-åŸºäºç¼–è¯‘å™¨æ±‡ç¼–æ–‡ä»¶çš„æ’æ¡©"><a href="#a-åŸºäºç¼–è¯‘å™¨æ±‡ç¼–æ–‡ä»¶çš„æ’æ¡©" class="headerlink" title="a. åŸºäºç¼–è¯‘å™¨æ±‡ç¼–æ–‡ä»¶çš„æ’æ¡©"></a>a. åŸºäºç¼–è¯‘å™¨æ±‡ç¼–æ–‡ä»¶çš„æ’æ¡©</h3><h4 id="1-afl-gcc-c"><a href="#1-afl-gcc-c" class="headerlink" title="1. afl-gcc.c"></a>1. afl-gcc.c</h4><ul>
<li><p>æ˜¯ä¸»æµç¼–è¯‘å™¨çš„ä¸€ä¸ªwrapperï¼Œæ ¹æ®å…·ä½“è°ƒç”¨çš„<code>afl-xxx</code>ç¼–è¯‘å™¨åæ¥è¿›è¡Œåˆ†æµï¼š</p>
<ul>
<li><p><code>afl-xxx</code>ç¼–è¯‘å™¨éƒ½æ˜¯<code>afl-gcc</code>çš„ä¸€ä¸ªè½¯é“¾æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ll afl-gcc afl-g++ afl-clang afl-clang++<br>lrwxrwxrwx 1 chan chan     7 Nov  3 23:52 afl-clang -&gt; afl-gcc*<br>lrwxrwxrwx 1 chan chan     7 Nov  3 23:52 afl-clang++ -&gt; afl-gcc*<br>lrwxrwxrwx 1 chan chan     7 Nov  3 23:52 afl-g++ -&gt; afl-gcc*<br>-rwxrwxr-x 1 chan chan 22976 Nov  3 23:52 afl-gcc*<br></code></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
<li><p>ä¸<code>afl-as</code>çš„ç»“åˆä½¿ç”¨ï¼šä½¿ç”¨<code>gcc/clang</code> <code>-B</code>é€‰é¡¹æ¥æŒ‡å®šæ±‡ç¼–å™¨è·¯å¾„ï¼Œå³AFLæœ¬èº«çš„è·¯å¾„</p>
<p>æ¢è¨€ä¹‹ï¼Œ<code>afl-gcc</code>æœ¬è´¨ä¸Šè¿˜æ˜¯è°ƒç”¨çš„åŸæ¥çš„ç¼–è¯‘å™¨ï¼Œåªä¸è¿‡å°†æ±‡ç¼–å™¨æ›¿æ¢ä¸ºäº†<code>afl-as</code>ï¼ˆè€Œ<code>afl-as</code>çš„ä¸»è¦ä½œç”¨å°±æ˜¯è¿›è¡Œæ’æ¡©ï¼ï¼‰</p>
</li>
<li><p><strong>æºç è§£æ</strong>ï¼š</p>
<ul>
<li><p><code>find_as()</code>ï¼šåœ¨ç¯å¢ƒå˜é‡<code>AFL_PATH</code>ã€AFLæœ¬èº«çš„è·¯å¾„ã€‘æä¾›â€å‡çš„â€GNUæ±‡ç¼–å™¨ï¼Œå³<code>AFL_PATH/as</code>ï¼›æˆ–è€…æ ¹æ®<code>argv[0]</code>çš„è·¯å¾„è¿›è¡Œæ´¾ç”Ÿã€‚<span class="github-emoji"><span>ğŸ““</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4d3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ³¨ï¼šè¿™é‡Œçš„<code>as</code>æœ¬èº«ä¹Ÿæ˜¯<code>afl-as</code>çš„ä¸€ä¸ªè½¯é“¾æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ll afl-as as<br>-rwxrwxr-x 1 chan chan 37544 Nov  3 23:52 afl-as*<br>lrwxrwxrwx 1 chan chan     6 Nov  3 23:52 as -&gt; afl-as*<br></code></pre></td></tr></tbody></table></figure>
</li>
<li><p><code>edit_params()</code>ï¼šæ„é€ æ–°çš„å‘½ä»¤è¡Œé€‰é¡¹ï¼Œå³å°†<code>argv</code>ä¸­çš„é€‰é¡¹æ‹·è´åˆ°<code>cc_params</code>ä¸­ï¼ŒåŒæ—¶æä¾›ä¸€äº›å¿…è¦çš„ç¼–è¾‘ï¼š</p>
<ul>
<li><p>é¦–å…ˆå¯¹<code>argv[0]</code>è¿›è¡ŒåŒ¹é…ï¼Œå³è¿›è¡Œåˆ†æµï¼š</p>
<p><code>afl-clang</code> =&gt; <code>clang</code>; </p>
<p><code>afl-clang++</code> =&gt; <code>clang++</code>; </p>
<p><code>afl-g++</code> =&gt; <code>g++</code>; </p>
<p><code>afl-gcj</code> =&gt; <code>gcj</code>; </p>
<p><code>afl-gcc</code> =&gt; <code>gcc</code></p>
</li>
<li><p>ç„¶åå°†<code>argv</code>ä¸­å…¶ä»–çš„é€‰é¡¹æ‹·è´åˆ°<code>cc_params</code>ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œå¯¹ä¸€äº›é€‰é¡¹è¿›è¡Œå¤„ç†ï¼š</p>
<ul>
<li><code>-B</code>å°†è¢«è¦†å†™</li>
<li><code>-integrated-as</code>ã€<code>-pipe</code>ã€å°†è¢«åˆ é™¤</li>
<li>å¦‚æœé‡åˆ°<code>-fsanitize=address</code>æˆ–<code>-fsanitize=memory</code>æ—¶ï¼Œå°†<code>asan_set</code>æ ‡å¿—å˜é‡è®¾ç½®ä¸º1ï¼Œå°†é€‰é¡¹æ·»åŠ åˆ°<code>cc_params</code></li>
<li>å¦‚æœé‡åˆ°<code>FORTIFY_SOURCE</code>è®¾ç½®é¡¹ï¼Œåˆ™å°†<code>fortify_set</code>æ ‡å¿—å˜é‡è®¾ç½®ä¸º1ï¼Œå°†é€‰é¡¹æ·»åŠ åˆ°<code>cc_params</code>  <em># ç¼–è¯‘å™¨çš„ä¸€ç§å®‰å…¨æ£€æµ‹æœºåˆ¶ï¼Œé˜²æº¢å‡º</em></li>
</ul>
</li>
<li><p>ç„¶åæ·»åŠ -Bé€‰é¡¹ï¼Œå³<code>-B as_path</code>ï¼Œ<code>as_path</code>ä¸º<code>find_as()</code>å‡½æ•°è®¾ç½®çš„æ±‡ç¼–å™¨è·¯å¾„ã€‚æ¥ç€è¿›è¡Œ5ä¸ªåˆ¤æ–­ï¼š</p>
<ul>
<li><p>å¦‚æœæ˜¯<code>clang_mode</code>ï¼Œæ·»åŠ <code>-no-integrated-as</code>é€‰é¡¹ä»¥é¿å…ä½¿ç”¨clangé›†æˆçš„æ±‡ç¼–å™¨</p>
</li>
<li><p>å¦‚æœè®¾ç½®äº†ç¯å¢ƒå˜é‡<code>AFL_HARDEN</code>ï¼Œåˆ™æ·»åŠ  <code>-fstack-protector-all</code> [15] å’Œ <code>-D_FORTIFY_SOURCE=2</code></p>
</li>
<li><p>å¦‚æœ<code>asan_set == 1</code>ï¼Œåˆ™å°†ç¯å¢ƒå˜é‡<code>AFL_USE_ASAN</code>è®¾ç½®ä¸º1ï¼›å¦åˆ™ï¼Œåˆ¤æ–­æ˜¯å¦è®¾ç½®äº†<code>AFL_USE_ASAN</code>æˆ–<code>AFL_USE_MSAN</code>ï¼Œå¹¶æ£€æŸ¥ç›¸åº”çš„äº’æ–¥æ€§å’Œæ·»åŠ ç›¸åº”çš„é€‰é¡¹ï¼ˆ<code>-U_FORTIFY_SOURCE</code> å’Œ <code>-fsanitize=address/memory</code>ï¼‰</p>
</li>
<li><p>å¦‚æœè®¾ç½®äº†ç¯å¢ƒå˜é‡<code>AFL_DONT_OPTIMIZE</code>ï¼Œé‚£ä¹ˆå°†ä¸è¿›è¡Œä¼˜åŒ–æ“ä½œï¼Œå¦åˆ™å°†æ·»åŠ ä¸‹è¿°é€‰é¡¹ï¼š</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>-g</td>
<td>å…¨å±€ç»‘å®šï¼Œä¸»è¦ç”¨äºdebug</td>
</tr>
<tr>
<td>-O3</td>
<td>O3çº§ä¼˜åŒ–</td>
</tr>
<tr>
<td>-funroll-loops</td>
<td>é¿å…ä¼˜åŒ–å™¨å±•å¼€å¾ªç¯ï¼Œå…¶ä¸»è¦ç›®çš„æœ‰ä¸¤ä¸ªï¼š<br><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¾¿äºå¯¹å¾ªç¯ä½“çš„è¾¹è¿›è¡Œè·Ÿè¸ª<br><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é¿å…å¾ªç¯ä½“å†…å…¶ä»–è¾¹çš„æ•°é‡çˆ†ç‚¸ï¼ˆå¾ªç¯å±•å¼€åä¼šäº§ç”Ÿå†—ä½™è¾¹ï¼‰</td>
</tr>
<tr>
<td>-D__AFL_COMPILER=1</td>
<td># ä¸æ˜¯ç¼–è¯‘å™¨æœ¬èº«çš„é€‰é¡¹<br>åœ¨ChangeLogä¸­ï¼Œè¯¥å˜é‡ç”¨æ¥æŒ‡ç¤ºè¯¥ç¨‹åºæ˜¯åœ¨afl-gcc / afl-clang / afl-clang-fastä¸‹æ„å»ºçš„ï¼Œå¹¶ä¸”å…è®¸è‡ªå®šä¹‰çš„ä¼˜åŒ–</td>
</tr>
<tr>
<td>-DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1</td>
<td>-</td>
</tr>
</tbody></table>
</li>
<li><p>å¦‚æœè®¾ç½®äº†ç¯å¢ƒå˜é‡<code>AFL_NO_BUILTIN</code>ï¼Œé‚£ä¹ˆå°†ä¸è¿›è¡Œç›¸å…³å‡½æ•°çš„å†…ç½®æ›¿æ¢ï¼ˆå³æ±‡ç¼–å¤„å°†ä½¿ç”¨<code>call</code>ç›¸å…³å‡½æ•°ï¼Œå¯¹äº<code>AFLæ’æ¡©</code>æ¥è¯´ï¼Œè¿™å°†å¼•å…¥é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤é»˜è®¤è¿›è¡Œ<code>builtin</code>ï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡æ·»åŠ ä¸‹è¿°é€‰é¡¹æ¥å®ç°ï¼š</p>
<table>
<thead>
<tr>
<th align="center">é€‰é¡¹</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-fno-builtin-strcmp</td>
</tr>
<tr>
<td align="center">-fno-builtin-strncmp</td>
</tr>
<tr>
<td align="center">-fno-builtin-strcasecmp</td>
</tr>
<tr>
<td align="center">-fno-builtin-strncasecmp</td>
</tr>
<tr>
<td align="center">-fno-builtin-memcmp</td>
</tr>
<tr>
<td align="center">-fno-builtin-strstr</td>
</tr>
<tr>
<td align="center">-fno-builtin-strcasestr</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>execvp()</code>ï¼šæ‰§è¡Œæ„é€ çš„å‘½ä»¤è¡Œï¼Œå³<code>cc_params</code>ã€‚è¯¥å‘½ä»¤è¡Œå°†è°ƒç”¨ç¼–è¯‘å™¨ç”Ÿæˆç›¸åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ­£å¦‚å‰æ‰€è¿°ï¼Œ<code>-B</code>æŒ‡å®šäº†<code>afl</code>çš„æ±‡ç¼–å™¨è¿›è¡Œæ’æ¡©æ“ä½œï¼Œå› æ­¤ä¸‹é¢æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»<code>afl-as.c</code>çš„å…·ä½“æµç¨‹ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 id="2-afl-as-c"><a href="#2-afl-as-c" class="headerlink" title="2. afl-as.c"></a>2. afl-as.c</h4><ul>
<li><p>ç”±å‰æ‰€è¿°ï¼Œ<code>afl-gcc/clang/g++/clang++/gcj</code>é€šè¿‡<code>-B</code>å‚æ•°æŒ‡å®šäº†<code>AFLçš„æ±‡ç¼–å™¨</code>è·¯å¾„ï¼Œé‚£ä¹ˆåœ¨gcc/g++/clang/clang++/gcjç”Ÿæˆç›®æ ‡æ–‡ä»¶/å¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå°†ä½¿ç”¨afl-asä½œä¸ºå…¶ç¼–è¯‘å™¨ï¼Œè€Œafl-asæœ¬èº«ä¹Ÿæ˜¯asä¸€ä¸ªwrapperï¼š</p>
<ul>
<li>å…ˆå¯¹ç¼–è¯‘å™¨äº§ç”Ÿçš„æ±‡ç¼–æ–‡ä»¶è¿›è¡Œ<strong>æ’æ¡©</strong></li>
<li>ç„¶åå†è°ƒç”¨ç³»ç»Ÿçš„<code>as</code>æ¥<strong>ç”Ÿæˆç›¸åº”çš„æœºå™¨ç </strong></li>
</ul>
</li>
<li><p><span class="github-emoji"><span>ğŸ’­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4ad.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½†æ˜¯è¿™æ ·ä¸€æ¥æ— æ³•å¯¹<code>afl-as</code>è¿›è¡Œè°ƒè¯•ï¼Ÿ</p>
<ul>
<li><p>ç»è¿‡å¯¹<code>afl-as</code>çš„ç®€å•åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡<code>afl-gcc -S</code>ç”Ÿæˆæ±‡ç¼–æ–‡ä»¶ï¼Œç„¶åå°†æ±‡ç¼–æ–‡ä»¶æ”¾ç½®åœ¨<code>tmp</code>ç›®å½•ä¸‹</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ afl-gcc -S afl_inst_test.c -o afl_inst_test.s<br>afl-cc 2.57b by &lt;lcamtuf@google.com&gt;<br>afl_inst_test.c: In <span class="hljs-keyword">function</span> â€˜mainâ€™:<br>afl_inst_test.c:12:2: warning: ignoring <span class="hljs-built_in">return</span> value of â€˜scanfâ€™, declared with attribute warn_unused_result [-Wunused-result]<br>  scanf(<span class="hljs-string">"%d"</span>, &amp;a);<br>  ^~~~~~~~~~~~~~~<br>$ <span class="hljs-built_in">mv</span> afl_inst_test.s /tmp<br></code></pre></td></tr></tbody></table></figure>
</li>
<li><p>ä½¿ç”¨<code>afl-as</code>å¯¹ä¸Šè¿°äº§ç”Ÿçš„æ±‡ç¼–æ–‡ä»¶è¿›è¡Œæ±‡ç¼–æ“ä½œï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ /home/chan/some_c_test/AFLAPI/afl-as -o afl_inst_test.o /tmp/afl_inst_test.s<br>afl-as 2.57b by &lt;lcamtuf@google.com&gt;<br>[+] Instrumented 4 locations (64-bit, non-hardened mode, ratio 100%).<br></code></pre></td></tr></tbody></table></figure>

<p>:happy:ç”±ä¸Šè¿°çš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¯¥æ±‡ç¼–æ–‡ä»¶å·²ç»æˆåŠŸæ’æ¡©äº†ã€‚ä½†è¿™é‡Œæˆ‘ä»¬æ— æ³•æ•è·åˆ°æ’æ¡©åçš„æ±‡ç¼–æ–‡ä»¶ï¼Œå› æ­¤éœ€è¦å¯¹<code>afl-as</code>è¿›è¡Œdebugã€‚</p>
</li>
</ul>
</li>
<li><p><strong>æºç è§£æ</strong>ï¼š</p>
<p>ä¸€äº›å±€éƒ¨å˜é‡ï¼šinst_ratio_str =&gt; <strong>inst_ratio</strong> [é»˜è®¤ä¸º100ï¼Œæ’æ¡©ç‡ 0~100]ï¼›<strong>sanitizer</strong> [æ˜¯å¦å¯ç”¨ASAN/MSAN?] </p>
<ul>
<li><p><code>srandom()</code>ï¼šç½®æ—¶é—´ç§å­ï¼Œç§å­ç”±å½“å‰æ—¶é—´çš„ç§’ã€å¾®ç§’å’Œè¿›ç¨‹pidå¼‚æˆ–å¾—åˆ°</p>
</li>
<li><p><code>edit_params()</code>ï¼šæ„é€ æ±‡ç¼–æ‰€ä½¿ç”¨çš„å‘½ä»¤è¡Œ</p>
<ul>
<li><p>ç¯å¢ƒå˜é‡<code>TMPDIR</code>å¯ä»¥è‡ªå®šä¹‰ä¸´æ—¶æ–‡ä»¶å¤¹ï¼Œæ­¤å¤–ï¼Œç¯å¢ƒå˜é‡<code>TEMP</code>å’Œ<code>TMP</code>åŒæ ·æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Œå¦åˆ™<code>tmp_dir</code>é»˜è®¤ä¸ºâ€<code>/tmp</code>â€œï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹å‰å°†æ±‡ç¼–æ–‡ä»¶æ”¾ç½®åœ¨<code>tmp</code>ç›®å½•ä¸‹çš„åŸå›  <span class="github-emoji"><span>âœ‹</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/270b.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
</li>
<li><p>ç„¶åå°†åŸ<code>argv</code>ã€å‰ <code>argc-1</code> ä¸ªé€‰é¡¹ã€‘æ‹·è´åˆ°<code>as_params[]</code>ä¸­ã€‚è¿™é‡Œæ£€æµ‹åŸå‘½ä»¤è¡Œä¸­æ˜¯å¦å‡ºç°<code>"--64"</code> / <code>"--32"</code>  =&gt; å°†<code>use_64bit</code>æ ‡å¿—å˜é‡ç›¸åº”çš„è®¾ç½®ä¸º1 / 0</p>
<p><span class="github-emoji"><span>âš </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ³¨ï¼šåœ¨è°ƒç”¨<code>afl-as</code>æ—¶ï¼Œå¿…é¡»å°†è¾“å…¥æ–‡ä»¶æ”¾ç½®åœ¨æœ€åï¼Œå³<code>afl-as -o xxx.o xxx.s</code><span class="github-emoji"><span>âœ”</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ï¼Œ<code>afl-as xxx.s -o xxx.o</code><span class="github-emoji"><span>âŒ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> </p>
<p><code>input_file = argv[argc - 1] // xxx.s</code></p>
</li>
<li><p>åˆ¤æ–­<code>input_file</code>æ˜¯å¦åœ¨<code>/tmp</code>æˆ–<code>/var/tmp</code>ï¼Œå¦‚æœä¸å†åˆ™å°†<code>pass_thru</code>ç½®ä¸º1ã€è¿™ä¼šå¯¼è‡´åé¢ä¸è¿›è¡Œæ’æ¡©æ“ä½œã€‘</p>
<p><code>modified_file</code>ä¸ºæ’æ¡©åæ±‡ç¼–æ–‡ä»¶ï¼Œè¿™é‡Œæ ¹æ®æ—¶é—´å’Œpidéšæœºåˆ†é…ä¸€ä¸ªåå­—ï¼Œå¦‚<code>/tmp/.afl-4270-1669033267.s</code></p>
<p>ç„¶åå°†<code>modified_file</code>æ·»åŠ åˆ°<code>as_params</code>æœ€åï¼Œä½œä¸ºæ±‡ç¼–å™¨çš„è¾“å…¥æ–‡ä»¶ï¼</p>
</li>
</ul>
</li>
<li><p>å¦‚æœè®¾ç½®äº†ç¯å¢ƒå˜é‡<code>AFL_USE_ASAN</code>æˆ–<code>AFL_USE_MSAN</code>ï¼Œå°†sanitizerç½®ä¸º1ï¼Œä¸”å°†<strong>æ’æ¡©ç‡inst_ratioé™¤ä»¥3</strong></p>
<p><span class="github-emoji"><span>â“</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2753.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è¿™é‡Œä¸ºå•¥è¦å°†<code>inst_ratio</code>é™¤ä»¥3ï¼Ÿ</p>
<blockquote>
<p>æºç æ³¨é‡Šä¸­ä½œè€…è¿™æ ·æè¿°ï¼š</p>
<p>â€œåœ¨ä½¿ç”¨ASANç¼–è¯‘æ—¶ï¼Œæ²¡æœ‰ä¸€ä¸ªç‰¹åˆ«ä¼˜é›…çš„æ–¹æ³•è·³è¿‡ASANç‰¹æœ‰çš„åˆ†æ”¯ï¼Œä½†å¯ä»¥é€šè¿‡æ’æ¡©ç‡ä¸Šè¿›è¡Œè¡¥å¿â€¦â€</p>
<p>è§è§£ï¼š<span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ASANä¼šå¼•å…¥ç”±ASANæ‰€å¯¼è‡´çš„ç‰¹å®šåˆ†æ”¯ï¼Œè€Œå¦‚å‰æ‰€è¿°ï¼ŒASANæ’æ¡©æ˜¯åœ¨ç¼–è¯‘è¿‡ç¨‹å®Œæˆçš„ï¼Œè€ŒAFLåœ¨ç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–åŸºç¡€ä¸Šè¿›è¡Œæ’æ¡©ï¼Œå› æ­¤ä¼šå¯¹ASANæœ¬èº«ç‰¹å®šçš„åˆ†æ”¯è¿›è¡Œæ’æ¡©ã€‚æ¦‚ç‡æ’æ¡©ï¼ˆ33%ï¼‰åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½å¤Ÿåæ˜ è½¯ä»¶çš„çœŸå®è¦†ç›–ç‡å¤§å°ã€‚</p>
<p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ASANçš„æ’æ¡©æ˜¯<strong>é‡é‡çº§</strong>çš„ï¼Œå› æ­¤ASANå¼•å…¥çš„è¾¹å¯èƒ½ä¼šå¯¼è‡´æ¯”ç‰¹ä½å›¾ç¢°æ’æ€§æå‡ï¼Œè€Œæ¦‚ç‡æ’æ¡©èƒ½å¤Ÿè§£å†³è¿™ä¸€é—®é¢˜</p>
</blockquote>
</li>
<li><p><code>add_instrumentation()</code>ï¼šå¯¹æ±‡ç¼–æ–‡ä»¶è¿›è¡Œ<strong>æ’æ¡©</strong>ï¼ˆåˆ†æ”¯å¤„æ’æ¡© + ç›¸å…³è°ƒç”¨å‡½æ•°ï¼‰</p>
<ul>
<li><p>å¦‚æœ<code>input_file</code>æ–‡ä»¶ä¸èƒ½æ‰“å¼€ï¼Œåˆ™å°†<code>stdin</code>ä½œä¸ºè¾“å…¥ï¼›<code>modified_file</code>ä½œä¸ºè¾“å‡ºæ–‡ä»¶ï¼›</p>
</li>
<li><p>ã€<strong>åˆ†æ”¯å¤„æ’æ¡©</strong>ã€‘è¯»å–<code>input_file</code>ä¸­çš„æ¯ä¸€è¡Œï¼Œå¹¶åšä¸€ç³»åˆ—çš„åˆ¤æ–­ï¼Œå…¶ä¸»è¦æ‰¾åˆ°ä¸‰ä¸ªä½ç½®ï¼š</p>
<ul>
<li><strong>å‡½æ•°å¤´ï¼š</strong></li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">function_name:<br>.LFB23:<br>	.file 1 "afl_inst_test.c"<br>	.loc 1 3 0<br>	.cfi_startproc<br>.LVL0:<br>	.loc 1 5 0<br>	# &lt;&lt;======== instrumentation here<br>	movl	%edi, %eax<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><strong>jx/jxxçš„ä¸¤æ¡åˆ†æ”¯ï¼š</strong></li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># branch 1<br>.LVL7:<br>	.loc 1 14 0<br>	movl	4(%rsp), %edx<br>	cmpl	$0, %edx<br>	jg	.L11<br>	# &lt;&lt;======== instrumentation here<br>	.loc 1 16 0<br>	jne	.L12<br>	# &lt;&lt;======== instrumentation here<br>...<br># branch 2<br>.L11:<br>	.cfi_restore_state<br>.LVL10:<br>.LBB26:<br>.LBB27:<br>	.loc 2 104 0<br>	# &lt;&lt;======== instrumentation here<br>	leaq	.LC2(%rip), %rsi<br>	movl	$1, %edi<br>	xorl	%eax, %eax<br>	call	__printf_chk@PLT<br>.LVL11:<br>	jmp	.L7<br>.LVL12:<br>.L12:<br>.LBE27:<br>.LBE26:<br>.LBB28:<br>.LBB29:<br>	# &lt;&lt;======== instrumentation here<br>	leaq	.LC3(%rip), %rsi<br>	movl	$1, %edi<br>	xorl	%eax, %eax<br>	call	__printf_chk@PLT<br></code></pre></td></tr></tbody></table></figure>

<p><span class="github-emoji"><span>ğŸ¤”</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ±‡ç¼–ä¸­<code>.</code>å¼€å¤´æ ‡è¯†çš„æ„ä¹‰ [16]ï¼š</p>
<p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>.loc</code>ï¼š**Line Of Code [-g?]**ï¼Œæ ¼å¼ä¸º <code>.loc æ–‡ä»¶åºå· è¡Œåºå· [åˆ—] [é€‰é¡¹]</code>ï¼Œåœ¨ä¸Šç¤ºä¾‹ä¸­ï¼Œ<code>.loc 1 14 0</code>è¡¨ç¤ºfile 1ï¼šafl_inst_test.cï¼Œç¬¬14è¡Œç¬¬0åˆ— [17]</p>
<p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> GCCä½¿ç”¨<code>.L</code>ç”¨äº<strong>æœ¬åœ°æ ‡ç­¾</strong></p>
<blockquote>
<p>æœ¬åœ°ç¬¦å·æ˜¯ä»¥æŸç§æœ¬åœ°æ ‡ç­¾å‰ç¼€å¼€å¤´çš„ä»»ä½•ç¬¦å·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒELFç³»åˆ—çš„æœ¬åœ°æ ‡ç­¾å‰ç¼€æ˜¯â€œ.Lâ€</p>
<p>æœ¬åœ°ç¬¦å·åœ¨æ±‡ç¼–å™¨ä¸­è¢«å®šä¹‰å’Œä½¿ç”¨ï¼Œä½†å®ƒä»¬é€šå¸¸ä¸è¢«ä¿å­˜åœ¨ç›®æ ‡æ–‡ä»¶ä¸­ã€‚å› æ­¤åœ¨è°ƒè¯•æ—¶å®ƒä»¬æ˜¯ä¸å¯è§çš„ã€‚å¯ä»¥ä½¿ç”¨<code>-L</code>é€‰é¡¹ä¿ç•™ç›®æ ‡æ–‡ä»¶ä¸­çš„æœ¬åœ°ç¬¦å· [18]</p>
<p>e.g.</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;/tmp$ as -c -L afl_inst_test.s <span class="hljs-comment"># you can also use `as --keep-locals -c afl_inst_test.s`</span><br>&gt;/tmp$ nm a.out<br>&gt;0000000000000000 T fun<br>      U _GLOBAL_OFFSET_TABLE_<br>      U __isoc99_scanf<br>&gt;000000000000006d t .L11<br>&gt;0000000000000082 t .L12<br>&gt;0000000000000097 t .L13<br>&gt;...<br>&gt;/tmp$ as -c afl_inst_test.s <br>&gt;/tmp$ nm a.out<br>&gt;0000000000000000 T fun<br>      U _GLOBAL_OFFSET_TABLE_<br>      U __isoc99_scanf<br>&gt;0000000000000000 r .LC0<br>&gt;0000000000000000 r .LC1<br>&gt;0000000000000003 r .LC2<br>&gt;000000000000001c r .LC3<br>&gt;0000000000000035 r .LC4<br>&gt;0000000000000000 T main<br>      U __printf_chk<br>      U __stack_chk_fail<br>&gt;/tmp$ <br></code></pre></td></tr></tbody></table></figure>
</blockquote>
<p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>.L</code><strong>å‰ç¼€</strong>ï¼ˆæ˜¯DWARFè°ƒè¯•ä¿¡æ¯ï¼Œä¸é‡è¦ï¼‰ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> FUNC_BEGIN_LABEL  <span class="hljs-string">"LFB"</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> FUNC_END_LABEL    <span class="hljs-string">"LFE"</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BLOCK_BEGIN_LABEL <span class="hljs-string">"LBB"</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> BLOCK_END_LABEL   <span class="hljs-string">"LBE"</span></span><br>ASM_GENERATE_INTERNAL_LABEL (loclabel, <span class="hljs-string">"LVL"</span>, loclabel_num);<br></code></pre></td></tr></tbody></table></figure>

<p>LFBï¼šå‡½æ•°å¼€å§‹ï¼› LFEï¼šå‡½æ•°ç»“æŸï¼›LBBï¼šå—å¼€å§‹ï¼›LBEï¼šå—ç»“æŸï¼›LVLï¼šå°šä¸çŸ¥</p>
<p>è¯¦è§ [19]</p>
</li>
<li><p>ã€ç›¸å…³è°ƒç”¨å‡½æ•°çš„é™„åŠ ã€‘æœ€åï¼Œå°†<code>main_payload_64</code>æˆ–<code>main_payload_32</code>æ·»åŠ åˆ°æ±‡ç¼–æ–‡ä»¶çš„æœ«å°¾å¤„ã€‚è‡³æ­¤ï¼Œæ‰€æœ‰çš„æ’æ¡©è¿‡ç¨‹å‡å·²å®Œæˆï¼</p>
</li>
</ul>
</li>
<li><p><code>execvp()</code>ï¼š<code>fork</code>ä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡Œæ„é€ çš„æ–°çš„<code>as_params</code>ï¼Œå³å¯¹æ’æ¡©åçš„æ±‡ç¼–æ–‡ä»¶è¿›è¡Œæ±‡ç¼–æ“ä½œã€‚æœ€ååˆ é™¤ä¸´æ—¶æ–‡ä»¶ [<code>modified_file</code>]ï¼Œè‡³æ­¤ï¼Œæ±‡ç¼–ä»»åŠ¡å®Œæˆ</p>
</li>
</ul>
</li>
</ul>
<h4 id="3-afl-as-h-æ¡©ä»£ç è§£æ"><a href="#3-afl-as-h-æ¡©ä»£ç è§£æ" class="headerlink" title="3. afl-as.h (æ¡©ä»£ç è§£æ)"></a>3. afl-as.h (æ¡©ä»£ç è§£æ)</h4><ul>
<li>ä¸»è¦æœ‰ä¸¤ä¸ªæ¡©ä»£ç ï¼š<span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>trampoline_fmt_64/trampoline_fmt_32</code>ï¼›<span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>main_payload_64/main_payload_32</code>ï¼›</li>
</ul>
<p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>trampoline_fmt_64/trampoline_fmt_32</code>ï¼ˆä»¥64ä½ä¸ºä¾‹ï¼‰ï¼š</p>
<ul>
<li>æ±‡ç¼–ç ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs assembly">/* --- AFL TRAMPOLINE (64-BIT) --- */<br><br>.align 4<br><br>leaq -(128+24)(%rsp), %rsp # åˆ†é…152å­—èŠ‚çš„æ ˆç©ºé—´<br>movq %rdx,  0(%rsp) # ä¿å­˜ç°åœº<br>movq %rcx,  8(%rsp)<br>movq %rax, 16(%rsp)<br>movq $0x%08x, %rcx    /* %08xæ˜¯ä¸€ä¸ªæ¯”ç‰¹ä½å›¾å¤§å°å†…çš„éšæœºæ•° */<br>call __afl_maybe_log<br>movq 16(%rsp), %rax # æ¢å¤ç°åœº<br>movq  8(%rsp), %rcx<br>movq  0(%rsp), %rdx<br>leaq (128+24)(%rsp), %rsp # å¤åŸæ ˆ<br><br>/* --- END --- */<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>ä¸Šè¿°æ±‡ç¼–ç è°ƒç”¨äº†<code>__afl_maybe_log(%rcx[i.e.å½“å‰åˆ†æ”¯å¯¹åº”çš„éšæœºæ•°])</code>æ¥è®°å½•è¾¹çš„æƒ…å†µ</li>
</ul>
<p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <code>main_payload_64/main_payload_32</code>ï¼ˆä»¥64ä½ä¸ºä¾‹ï¼‰ï¼š</p>
<ul>
<li>æ±‡ç¼–ç ä¸»è¦åŒ…æ‹¬10ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>__afl_maybe_log</code>ã€<code>__afl_store</code>ã€<code>__afl_return</code>ã€<code>__afl_setup</code>ã€<code>__afl_setup_first</code>ã€<code>__afl_forkserver</code>ã€<code>__afl_fork_wait_loop</code>ã€<code>__afl_fork_resume</code>ã€<code>__afl_die</code>ã€<code>__afl_setup_abort</code></li>
<li><code>__afl_maybe_log</code>ã€<code>__afl_store</code>ã€<code>__afl_return</code>ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs assembly">__afl_maybe_log:<br><br>  lahf							   # save other flags to AH<br>  seto  %al						   # set OF to al<br><br>  /* Check if SHM region is already mapped. */<br><br>  movq  __afl_area_ptr(%rip), %rdx # __afl_area_ptræ˜¯å…±äº«çš„bitmapä½å›¾å†…å­˜å—<br>  testq %rdx, %rdx<br>  je    __afl_setup				   # je =&gt; jz å³åˆ¤æ–­è¯¥åœ°å€æ˜¯å¦ä¸º0ï¼›å¦‚æœä¸º0ï¼Œåˆ™è¿›è¡Œåˆå§‹åŒ–<br>  <br>__afl_store:<br><br>  /* Calculate and store hit for the code location specified in rcx. */<br><br>  xorq __afl_prev_loc(%rip), %rcx  # %rcx = pre ^ cur<br>  xorq %rcx, __afl_prev_loc(%rip)  # __afl_prev_loc = pre ^ cur ^ pre = cur<br>  shrq $1, __afl_prev_loc(%rip)    # __afl_prev_loc = cur &gt;&gt; 1<br>  # (pre &gt;&gt; 1) ^ cur<br>  incb (%rdx, %rcx, 1)             # __afl_area_ptr[%rcx] = __afl_area_ptr[%rcx] + 1<br><br>__afl_return:<br><br>  addb $127, %al				   # restore OF (if OF=1, al+127=128 =&gt; OF=1 else OF=0)<br>  sahf							   # restore other flags<br>  ret<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><code>__afl_setup</code>ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.align 8<br><br>__afl_setup:<br><br>  /* Do not retry setup if we had previous failures. */<br><br>  cmpb $0, __afl_setup_failure(%rip)  # å˜é‡__afl_setup_failureå¦‚æœä¸º0ï¼Œè¡¨ç¤ºä¹‹å‰é…ç½®æ²¡é—®é¢˜ï¼Œå¦åˆ™è¡¨ç¤ºä¹‹å‰å‡ºé”™äº†ï¼Œé‚£ä¹ˆè¿”å›<br>  jne __afl_return<br><br>  /* Check out if we have a global pointer on file. */<br><br>  movq  __afl_global_area_ptr@GOTPCREL(%rip), %rdx  # å°†__afl_global_area_ptrç§»é€åˆ°%rdx<br>  movq  (%rdx), %rdx							    # å°†%rdxæŒ‡å‘çš„å€¼èµ‹å€¼ç»™%rdx<br>  testq %rdx, %rdx									# åˆ¤æ–­%rdxæ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0ï¼Œè¡¨æ˜æœªè¿›è¡Œåˆå§‹åŒ–æ“ä½œ<br>  je    __afl_setup_first							# è·³è½¬åˆ°__afl_setup_firstè¿›è¡Œåˆå§‹åŒ–æ“ä½œ<br><br>  movq %rdx, __afl_area_ptr(%rip)					# å°†å…¨å±€æŒ‡é’ˆèµ‹å€¼ç»™__afl_area_ptr<br>  jmp  __afl_store									# æ›´æ–°å…¨å±€è¾¹è®¡æ•°<br><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><code>__afl_setup_first</code>ã€<code>__afl_forkserver</code>ã€<code>__afl_fork_resume</code>å’Œ<code>__afl_die</code>ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><code class="hljs assembly">__afl_setup_first:<br><br>  /* Save everything that is not yet saved and that may be touched by<br>     getenv() and several other libcalls we'll be relying on. */<br><br>  leaq -352(%rsp), %rsp<br>  <br>  # ä¿æŠ¤ç°åœº<br>  movq %rax,   0(%rsp)<br>  movq %rcx,   8(%rsp)<br>  movq %rdi,  16(%rsp)<br>  movq %rsi,  32(%rsp)<br>  movq %r8,   40(%rsp)<br>  movq %r9,   48(%rsp)<br>  movq %r10,  56(%rsp)<br>  movq %r11,  64(%rsp)<br><br>  movq %xmm0,  96(%rsp)<br>  movq %xmm1,  112(%rsp)<br>  movq %xmm2,  128(%rsp)<br>  movq %xmm3,  144(%rsp)<br>  movq %xmm4,  160(%rsp)<br>  movq %xmm5,  176(%rsp)<br>  movq %xmm6,  192(%rsp)<br>  movq %xmm7,  208(%rsp)<br>  movq %xmm8,  224(%rsp)<br>  movq %xmm9,  240(%rsp)<br>  movq %xmm10, 256(%rsp)<br>  movq %xmm11, 272(%rsp)<br>  movq %xmm12, 288(%rsp)<br>  movq %xmm13, 304(%rsp)<br>  movq %xmm14, 320(%rsp)<br>  movq %xmm15, 336(%rsp)<br><br>  /* Map SHM, jumping to __afl_setup_abort if something goes wrong. */<br><br>  /* The 64-bit ABI requires 16-byte stack alignment. We'll keep the<br>     original stack ptr in the callee-saved r12. */<br><br>  pushq %r12<br>  movq  %rsp, %r12					# å°†%rspæš‚å­˜åˆ°%r12ä¸­<br>  subq  $16, %rsp					# ä¸º%rspåˆ†é…16å­—èŠ‚çš„ç©ºé—´<br>  andq  $0xfffffffffffffff0, %rsp   # %rspæœ€åå››ä½æ¸…ç©ºå˜ä¸º0 ==&gt; æ ˆåœ°å€å¯¹é½åˆ°16å­—èŠ‚ï¼ˆåœ°å€æ˜¯16çš„æ•´æ•°å€ï¼‰<br><br>  leaq .AFL_SHM_ENV(%rip), %rdi		# å°†å­—ç¬¦ä¸²"__AFL_SHM_ID"åœ°å€ä¿å­˜åˆ°%rdi<br>call getenv@PLT						# è°ƒç”¨getenvï¼Œå³getenv("__AFL_SHM_ID")<br><br>  testq %rax, %rax					# getenvè¿”å›å€¼å°†ç§»é€åˆ°$raxï¼Œè¿™é‡Œåˆ¤æ–­raxæ˜¯å¦ä¸º0ï¼Œå¦‚æœè¿”å›å€¼ä¸º0åˆ™è·³è½¬åˆ°__afl_setup_abort<br>  je    __afl_setup_abort<br><br>  movq  %rax, %rdi					# å°†getenvè¿”å›çš„å­—ç¬¦ä¸²åœ°å€ç§»é€åˆ°%rdi(ç¬¬ä¸€ä¸ªå‚æ•°)<br>call atoi@PLT						# è°ƒç”¨atoiå°†ç¯å¢ƒå˜é‡__AFL_SHM_IDçš„å€¼è½¬ä¸ºæ•´å‹ï¼Œè¿”å›çš„æ•´å‹å€¼ä¿å­˜åœ¨%raxä¸­<br><br>  xorq %rdx, %rdx   /* shmat flags    */<br>  xorq %rsi, %rsi   /* requested addr */<br>  movq %rax, %rdi   /* SHM ID         */<br>call shmat@PLT						# è°ƒç”¨shmat(shmid --&gt; %rdi = %rax[atoiè¿”å›å€¼], shmaddr --&gt; %rsi = 0, shmflg --&gt; %rdx = 0)<br><br>  cmpq $-1, %rax					# è¿”å› -1 è¡¨ç¤ºshmatè°ƒç”¨å¤±è´¥ï¼Œåˆ™è·³è½¬åˆ°__afl_setup_abort<br>  je   __afl_setup_abort<br><br>  /* Store the address of the SHM region. */<br><br>  movq %rax, %rdx					# %raxä¿å­˜ç€è¿”å›çš„å…±äº«åœ°å€<br>  movq %rax, __afl_area_ptr(%rip)   # %raxä¿å­˜åˆ°__afl_area_ptrå˜é‡ä¸­<br><br>  movq __afl_global_area_ptr@GOTPCREL(%rip), %rdx  # __afl_global_area_ptræŒ‡é’ˆç§»é€åˆ°%rdx<br>  movq %rax, (%rdx)					# å°†è¿”å›çš„å…±äº«åœ°å€ç§»é€åˆ°__afl_global_area_ptræŒ‡é’ˆæ‰€æŒ‡å‘çš„å€¼<br>  movq %rax, %rdx					# å°†è¿”å›çš„åœ°å€ä¿å­˜åˆ°%rdxä¸­<br>  <br>__afl_forkserver:<br>  /* Enter the fork server mode to avoid the overhead of execve() calls. We<br>     push rdx (area ptr) twice to keep stack alignment neat. */<br><br>  pushq %rdx<br>  pushq %rdx						<br><br>  /* Phone home and tell the parent that we're OK. (Note that signals with<br>     no SA_RESTART will mess it up). If this fails, assume that the fd is<br>     closed because we were execve()d from an instrumented binary, or because<br>     the parent doesn't want to use the fork server. */<br><br>  movq $4, %rdx               /* length    */<br>  leaq __afl_temp(%rip), %rsi /* data      */<br>  movq $(198 + 1), %rdi       /* file desc */<br>call write@PLT						# è°ƒç”¨write(198, __afl_temp, 4)<br><br>  cmpq $4, %rax						# è¿”å›å€¼ä¿å­˜åˆ°%raxä¸­ï¼Œå¦‚æœ%rax == 4ï¼Œè¡¨æ˜å†™å…¥æˆåŠŸ<br>  jne  __afl_fork_resume			# å¦‚æœé€šä¿¡å¤±è´¥ï¼Œåˆ™è·³è½¬åˆ°__afl_fork_resume<br><br>__afl_fork_wait_loop:<br><br>  /* Wait for parent by reading from the pipe. Abort if read fails. */<br><br>  movq $4, %rdx               /* length    */<br>  leaq __afl_temp(%rip), %rsi /* data      */<br>  movq $198, %rdi             /* file desc */<br>call read@PLT						# è°ƒç”¨read(198, __afl_temp, 4)<br>  cmpq $4, %rax						# è¿”å›å€¼ä¿å­˜åˆ°%raxä¸­ï¼Œå¦‚æœ%rax == 4ï¼Œè¡¨æ˜è¯»å…¥æˆåŠŸ<br>  jne  __afl_die					# å¦åˆ™è·³è½¬åˆ°__afl_dieä¸­<br><br>  /* Once woken up, create a clone of our process. This is an excellent use<br>     case for syscall(__NR_clone, 0, CLONE_PARENT), but glibc boneheadedly<br>     caches getpid() results and offers no way to update the value, breaking<br>     abort(), raise(), and a bunch of other things :-( */<br><br>call fork@PLT						# è°ƒç”¨fork()<br>  cmpq $0, %rax						# åˆ¤æ–­fork()çš„è¿”å›å€¼ (=0 ==&gt; å­è¿›ç¨‹ï¼Œ &lt;0 ==&gt; å¤±è´¥ï¼Œ &gt;0 ==&gt; åœ¨ä¸»è¿›ç¨‹ä¸­è¿”å›å­è¿›ç¨‹PID)<br>  jl   __afl_die					# å¦‚æœ&lt;0(å¤±è´¥) åˆ™è·³è½¬åˆ°__afl_dieä¸­<br>  je   __afl_fork_resume			# å¦‚æœ=0() ä½äºå­è¿›ç¨‹ä¸­ï¼Œåˆ™è·³è½¬åˆ°__afl_fork_resume<br><br>  /* In parent process: write PID to pipe, then wait for child. */<br><br>  movl %eax, __afl_fork_pid(%rip)	# ã€è¯¥åˆ†æ”¯ä½äºçˆ¶è¿›ç¨‹ä¸­ã€‘ %eaxä¸ºfork()è¿”å›çš„å­è¿›ç¨‹PIDå€¼ï¼Œä¿å­˜åˆ°__afl_fork_pidä¸­<br><br>  movq $4, %rdx                   /* length    */<br>  leaq __afl_fork_pid(%rip), %rsi /* data      */<br>  movq $(198 + 1), %rdi             /* file desc */<br>call write@PLT						# è°ƒç”¨write(199, &amp;__afl_fork_pid, 4);<br><br>  movq $0, %rdx                   /* no flags  */<br>  leaq __afl_temp(%rip), %rsi     /* status    */<br>  movq __afl_fork_pid(%rip), %rdi /* PID       */<br>call waitpid@PLT					# è°ƒç”¨waitpid(__afl_fork_pid, __afl_temp, 0);<br>  cmpq $0, %rax						# waitpid()è¿”å›å€¼è‹¥â‰¤0ï¼Œåˆ™è·³è½¬åˆ°__afl_die<br>  jle  __afl_die<br><br>  /* Relay wait status to pipe, then loop back. */<br><br>  movq $4, %rdx               /* length    */<br>  leaq __afl_temp(%rip), %rsi /* data      */<br>  movq $(198 + 1), %rdi         /* file desc */<br>call write@PLT						# è°ƒç”¨write(199, &amp;__afl_temp, 4);<br><br>  jmp  __afl_fork_wait_loop			# å›åˆ°å¾ªç¯é¦–<br>  <br>__afl_fork_resume:					# è¯¥åˆ†æ”¯ä¸ºå­è¿›ç¨‹æ“ä½œ<br><br>  /* In child process: close fds, resume execution. */<br><br>  movq $198, %rdi<br>call close@PLT						# è°ƒç”¨close(198)<br><br>  movq $(198 + 1), %rdi<br>call close@PLT						# è°ƒç”¨close(199)<br>  # æ¢å¤ç°åœºï¼ï¼<br>  popq %rdx<br>  popq %rdx<br><br>  movq %r12, %rsp<br>  popq %r12<br><br>  movq  0(%rsp), %rax<br>  movq  8(%rsp), %rcx<br>  movq 16(%rsp), %rdi<br>  movq 32(%rsp), %rsi<br>  movq 40(%rsp), %r8<br>  movq 48(%rsp), %r9<br>  movq 56(%rsp), %r10<br>  movq 64(%rsp), %r11<br><br>  movq  96(%rsp), %xmm0<br>  movq 112(%rsp), %xmm1<br>  movq 128(%rsp), %xmm2<br>  movq 144(%rsp), %xmm3<br>  movq 160(%rsp), %xmm4<br>  movq 176(%rsp), %xmm5<br>  movq 192(%rsp), %xmm6<br>  movq 208(%rsp), %xmm7<br>  movq 224(%rsp), %xmm8<br>  movq 240(%rsp), %xmm9<br>  movq 256(%rsp), %xmm10<br>  movq 272(%rsp), %xmm11<br>  movq 288(%rsp), %xmm12<br>  movq 304(%rsp), %xmm13<br>  movq 320(%rsp), %xmm14<br>  movq 336(%rsp), %xmm15<br><br>  leaq 352(%rsp), %rsp<br><br>  jmp  __afl_store  # è·³è½¬åˆ°__afl_storeå»æ‰§è¡Œè¾¹çš„è®°å½•<br><br>__afl_die:<br><br>  xorq %rax, %rax<br>call _exit@PLT		# è°ƒç”¨exit(0)<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><code>__afl_setup_abort</code>ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs assembly">__afl_setup_abort:<br><br>  /* Record setup failure so that we don't keep calling<br>     shmget() / shmat() over and over again. */<br><br>  incb __afl_setup_failure(%rip)  # __afl_setup_failure++;<br>  # æ¢å¤ç°åœº<br>  movq %r12, %rsp<br>  popq %r12<br><br>  movq  0(%rsp), %rax<br>  movq  8(%rsp), %rcx<br>  movq 16(%rsp), %rdi<br>  movq 32(%rsp), %rsi<br>  movq 40(%rsp), %r8<br>  movq 48(%rsp), %r9<br>  movq 56(%rsp), %r10<br>  movq 64(%rsp), %r11<br><br>  movq  96(%rsp), %xmm0<br>  movq 112(%rsp), %xmm1<br>  movq 128(%rsp), %xmm2<br>  movq 144(%rsp), %xmm3<br>  movq 160(%rsp), %xmm4<br>  movq 176(%rsp), %xmm5<br>  movq 192(%rsp), %xmm6<br>  movq 208(%rsp), %xmm7<br>  movq 224(%rsp), %xmm8<br>  movq 240(%rsp), %xmm9<br>  movq 256(%rsp), %xmm10<br>  movq 272(%rsp), %xmm11<br>  movq 288(%rsp), %xmm12<br>  movq 304(%rsp), %xmm13<br>  movq 320(%rsp), %xmm14<br>  movq 336(%rsp), %xmm15<br><br>  leaq 352(%rsp), %rsp<br><br>  jmp __afl_return<br><br></code></pre></td></tr></tbody></table></figure>

<p><code>__afl_maybe_log()</code>ä¼ªä»£ç ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs c">__int64* __afl_area_ptr;<br>__int64 __afl_prev_loc;<br><span class="hljs-type">int</span> __afl_fork_pid;<br><span class="hljs-type">int</span> __afl_temp;<br>__int8 __afl_setup_failure;<br>__int64* __afl_global_area_ptr;<br><br><span class="hljs-type">void</span> _afl_maybe_log(__int64 random)<br>{<br>    <br>  __int64 flags;<br>  <span class="hljs-type">void</span>* shmaddr;<br>  <br>  v5 = v4;<br>  v6 = __afl_area_ptr;<br>  <span class="hljs-keyword">if</span> ( !__afl_area_ptr )<br>  {<br>    <span class="hljs-keyword">if</span> ( __afl_setup_failure )<br>      <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">if</span> ( __afl_global_area_ptr )<br>    {<br>      __afl_area_ptr = __afl_global_area_ptr;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>      <span class="hljs-type">char</span>* id = getenv(<span class="hljs-string">"__AFL_SHM_ID"</span>);<br>      <span class="hljs-keyword">if</span> ( !id || __afl_area_ptr = shmat(atoi(id), shmaddr, flags) )<br>      {<br>        __afl_setup_failure++;<br>        <span class="hljs-keyword">return</span>;<br>      }<br>      __afl_global_area_ptr = __afl_area_ptr;<br>      <span class="hljs-keyword">if</span> ( write(<span class="hljs-number">199</span>, &amp;_afl_temp, <span class="hljs-number">4</span>) == <span class="hljs-number">4</span> )<br>      {<br>        <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>        {<br>          <span class="hljs-type">int</span> pid = <span class="hljs-number">0</span>;<br>          <span class="hljs-keyword">if</span> ( read(<span class="hljs-number">198</span>, &amp;_afl_temp, <span class="hljs-number">4</span>) != <span class="hljs-number">4</span> )<br>            <span class="hljs-keyword">break</span>;<br>          <span class="hljs-keyword">if</span> ( __afl_fork_pid = fork() &lt; <span class="hljs-number">0</span> )<br>             <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);  					<span class="hljs-comment">// é€€å‡º</span><br>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( !__afl_fork_pid ){<br>            <span class="hljs-comment">// å­è¿›ç¨‹</span><br>            close(<span class="hljs-number">198</span>);  <span class="hljs-comment">// å…³é—­è¿™ä¸¤ä¸ªç®¡é“</span><br>      		close(<span class="hljs-number">199</span>);<br>			__afl_area_ptr[random ^ __afl_prev_loc]++;<br>            __afl_prev_loc = random &gt;&gt; <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span>;<br>          }<span class="hljs-keyword">else</span>{<br>            <span class="hljs-comment">// çˆ¶è¿›ç¨‹ï¼ˆforkserverï¼‰</span><br>          	write(<span class="hljs-number">199</span>, &amp;__afl_fork_pid, <span class="hljs-number">4</span>);  <span class="hljs-comment">// å°†pidå†™å…¥ç®¡é“? ä½œç”¨æ˜¯å•¥?</span><br>          	<span class="hljs-keyword">if</span> ( waitpid(__afl_fork_pid, &amp;__afl_temp, <span class="hljs-number">0</span>) &lt;= <span class="hljs-number">0</span> )<br>            	<span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);  					<span class="hljs-comment">// é€€å‡º</span><br>          	write(<span class="hljs-number">199</span>, &amp;__afl_temp, <span class="hljs-number">4</span>);     <span class="hljs-comment">// è¿™é‡Œå°†__afl_tempå†™å›æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</span><br>          }<br>        }<br>      }<br>    }<br>  }<span class="hljs-keyword">else</span>{<br>      __afl_area_ptr[random ^ __afl_prev_loc]++;<br>      __afl_prev_loc = random &gt;&gt; <span class="hljs-number">1</span>;<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p><span class="github-emoji"><span>ğŸ¤”</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¸Šè¿°æ’æ¡©æ®‹ç•™ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p>â€‹		çˆ¶è¿›ç¨‹çš„ä¸»è¦ä½œç”¨æ˜¯ç»´æŒä¸€ä¸ª<code>fork-server</code>ï¼Œé‚£å®ƒä¸AFLä¹‹é—´é€šè¿‡ä¸€ä¸ªç®¡é“è¿›è¡Œé€šä¿¡ï¼Œä½†é€šä¿¡çš„å…·ä½“ç»†èŠ‚æ˜¯å•¥å‘¢ï¼Ÿ</p>
<h4 id="4-ä¸AFLé€šä¿¡"><a href="#4-ä¸AFLé€šä¿¡" class="headerlink" title="4. ä¸AFLé€šä¿¡"></a>4. ä¸AFLé€šä¿¡</h4><ul>
<li><p>åœ¨AFLä¸­ï¼Œ<code>afl-fuzz</code>ä¸­<code>init_forkserver()</code>æ˜¯åˆå§‹åŒ–forkserverçš„å‡½æ•°ï¼š</p>
<ul>
<li>åœ¨è¯¥å‡½æ•°ä¸­ï¼Œ<code>afl-fuzz</code>ä¼š<code>fork</code>å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶ä¸ºç®¡é“åˆ†é…æ–°çš„fdï¼ˆ198 ==&gt; æ§åˆ¶ç®¡é“<code>ctl_pipe[0]</code>ï¼Œ199 ==&gt; çŠ¶æ€ç®¡é“<code>st_pipe[0]</code>ï¼‰ã€‚è€Œè¿™ä¸ªå­è¿›ç¨‹<code>execv</code>ä¸€ä¸ªè¢«æµ‹ç¨‹åºï¼Œè¿™ä¸ªè¢«æµ‹ç¨‹åºï¼ˆi.e. fork-serverï¼‰åœ¨è°ƒç”¨ç¬¬ä¸€ä¸ª<code>__afl_maybe_log()</code>å‡½æ•°æ—¶ï¼Œé¦–å…ˆä¼šå‘çŠ¶æ€ç®¡é“å†™å…¥4å­—èŠ‚çš„ä»»æ„æ•°æ®ï¼Œç„¶åå°†åœ¨whileå¾ªç¯ä¸­çš„ç¬¬ä¸€ä¸ª<code>read(198, &amp;_afl_temp, 4)</code>å¤„é˜»å¡ï¼Œç­‰å¾…<code>AFL-fuzzer</code>å‘æ¥ä¿¡æ¯ï¼›</li>
<li>è€Œåœ¨<code>afl-fuzz</code>çˆ¶è¿›ç¨‹ä¸­ï¼Œé€šè¿‡è¯»å–çŠ¶æ€ç®¡é“4å­—èŠ‚çš„æ•°æ®æ¥åˆ¤æ–­æ˜¯å¦æˆåŠŸå¯ç”¨<code>fork-server</code></li>
</ul>
</li>
<li><p>åœ¨AFLä¸­ï¼Œ<code>run_target()</code>å°†é€šçŸ¥<code>fork-server</code>å‡ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹æ¥è·‘æ¨¡ç³Šæµ‹è¯•ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ï¼š</p>
<ul>
<li><code>afl-fuzz</code>è¿›ç¨‹å°†4ä¸ªå­—èŠ‚çš„è¶…æ—¶æ—¶é—´å†™å…¥åˆ°æ§åˆ¶ç®¡é“</li>
<li><code>fork-server</code>åœ¨è¯»å–åˆ°4ä¸ªå­—èŠ‚ï¼ˆ0ï¼‰ä¹‹åï¼Œå°†åœæ­¢é˜»å¡ã€‚ç„¶å<code>fork()</code>å‡ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹æ¥è·‘å®é™…çš„è¢«æµ‹ç›®æ ‡ï¼Œ<code>pid</code>å°†é€šè¿‡çŠ¶æ€ç®¡é“é€å›ç»™<code>afl-fuzzer</code>ï¼Œç„¶åæ”¶é›†è¦†ç›–ç‡ä¿¡æ¯ã€‚è¿™é‡Œ<code>fork-server</code>å°†è¿™è¯»å…¥çš„å››å­—èŠ‚0ç”¨äº<code>waitpid()</code>çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œç„¶åç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚å­è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œ<code>fork-server</code>å†å‘çŠ¶æ€ç®¡é“å†™å…¥4å­—èŠ‚ï¼Œè¡¨æ˜è¢«æµ‹ç¨‹åºæ‰§è¡Œå®Œæ¯•</li>
<li><code>afl-fuzz</code>æ ¹æ®<code>fork</code>å‡ºæ¥çš„è¢«æµ‹ç¨‹åº<code>pid</code>çš„ç»“æŸä¿¡å·å’Œè¦†ç›–ç‡ä¿¡æ¯åšè¿›ä¸€æ­¥çš„åˆ†æå¤„ç†</li>
</ul>
</li>
<li><p>æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚å…¶ä¸­ â‘ â†’â‘¡â†’â‘¢ ä¸ºåˆ›å»º<code>fork-server</code>çš„è¿‡ç¨‹ï¼Œâ‘£â†’â‘¤â†’â‘¥â†’â‘¦â†’â‘§â†’â‘¨ ä¸ºä¸€æ¬¡å®Œæ•´çš„<code>run_target()</code>çš„è¿‡ç¨‹ã€‚</p>
</li>
</ul>
<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/13.png" srcset="/img/loading.gif" lazyload></p>
<center name="pic13">å›¾13 AFLä¸fork-serveré€šä¿¡æµç¨‹å›¾</center>

<h3 id="b-åŸºäºLLVMçš„æ’æ¡©"><a href="#b-åŸºäºLLVMçš„æ’æ¡©" class="headerlink" title="b. åŸºäºLLVMçš„æ’æ¡©"></a>b. åŸºäºLLVMçš„æ’æ¡©</h3><ul>
<li>afl-clang-fastã€afl-clang-fast++</li>
<li>åŸºäºLLVM <strong>Pass</strong>å®ç°</li>
</ul>
<h4 id="1-afl-clang-fast-c"><a href="#1-afl-clang-fast-c" class="headerlink" title="1. afl-clang-fast.c"></a>1. afl-clang-fast.c</h4><ul>
<li><p>æ˜¯clangå’Œclang++çš„ä¸€ä¸ªwrapperï¼Œæ ¹æ®å…·ä½“è°ƒç”¨çš„afl-clang-fast(++)æ¥åŒºåˆ†</p>
<ul>
<li>afl-clang-fast++æ˜¯afl-clang-fastçš„ä¸€ä¸ªè½¯é“¾æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ul>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ll afl-clang-fast afl-clang-fast++<br>-rwxrwxr-x 1 chan chan 24608 Nov 28 18:36 afl-clang-fast*<br>lrwxrwxrwx 1 chan chan    14 Nov 28 18:36 afl-clang-fast++ -&gt; afl-clang-fast*<br></code></pre></td></tr></tbody></table></figure>
</li>
<li><p>ä¸<strong>llvm Pass</strong>ï¼ˆ<code>afl-llvm-pass.so</code>ï¼‰ç»“åˆä½¿ç”¨ï¼šä½¿ç”¨<code>-Xclang</code>è®©clangè¿è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„<strong>Pass</strong></p>
<ul>
<li>ä¸<code>afl-gcc</code>çš„åŒºåˆ«ï¼šPassåœ¨<strong>ç¼–è¯‘å™¨è¿è¡Œæ—¶</strong>è¿›è¡Œæ’æ¡©ï¼Œè€Œ<code>afl-gcc</code>å¯¹<strong>ç¼–è¯‘å™¨è¿è¡Œç»“æŸå</strong>ç”Ÿæˆçš„æ±‡ç¼–æ–‡ä»¶è¿›è¡Œæ’æ¡©</li>
</ul>
</li>
<li><p><strong>æºç è§£æ</strong>ï¼š</p>
<ul>
<li><p><code>find_obj()</code>ï¼šå¯»æ‰¾<code>afl-llvm-rt.o</code>ç›®æ ‡æ–‡ä»¶ï¼Œå¹¶å°†AFLè·¯å¾„ä¿å­˜åˆ°<code>obj_path</code>å˜é‡ä¸­</p>
</li>
<li><p><code>edit_params()</code>ï¼šæ„é€ æ–°çš„ç¼–è¯‘å‘½ä»¤è¡Œé€‰é¡¹<code>cc_params</code>ï¼Œå°†<code>argv</code>ä¸­çš„é€‰é¡¹æ‹·è´åˆ°<code>cc_params</code>ä¸­ï¼ŒåŒæ—¶æä¾›ä¸€äº›å¿…è¦çš„ç¼–è¾‘ï¼š</p>
<ul>
<li><p>é¦–å…ˆå¯¹<code>argv[0]</code>è¿›è¡ŒåŒ¹é…ï¼Œå³è¿›è¡Œåˆ†æµï¼š</p>
<p><code>afl-clang-fast++</code> =&gt; <code>clang++</code></p>
<p><code>afl-clang-fast</code> =&gt; <code>clang</code></p>
</li>
<li><p>å¦‚æœä½¿ç”¨<code>trace_pc</code>æ¨¡å¼ï¼Œåˆ™åœ¨<code>cc_params</code>åè¿½åŠ <code>-fsanitize-coverage=trace-pc-guard</code>ï¼›å¦åˆ™è¿½åŠ ä¸¤ä¸ªé€‰é¡¹ï¼š<code>-Xclang -load</code>ï¼ˆåŠ è½½åŒ…å«æ’ä»¶æ³¨å†Œè¡¨çš„åŠ¨æ€åº“ï¼‰å’Œ<code>-Xclang obj_path/afl-llvm-pass.so</code>ã€‚æ­¤å¤–ï¼Œè¿˜è¦é¢å¤–è¿½åŠ ä¸€ä¸ª<code>-Qunused-arguments</code> [20] é€‰é¡¹æ¥é™é»˜å…³äºæœªä½¿ç”¨å‚æ•°çš„è­¦å‘Šã€‚</p>
</li>
<li><p>å°†<code>argv[]</code>ä¸­å…¶ä»–çš„é€‰é¡¹æ‹·è´åˆ°<code>cc_params</code>ï¼Œåœ¨æ­¤æœŸé—´å°†æ›´æ–°ä¸€äº›å˜é‡å€¼</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>å˜é‡</th>
</tr>
</thead>
<tbody><tr>
<td>-m32ã€armv7a-linux-androideabi</td>
<td>bit_mode = 32</td>
</tr>
<tr>
<td>-m64</td>
<td>bit_mode = 64</td>
</tr>
<tr>
<td>-x &lt;language&gt; (å°†è¾“å…¥æ–‡ä»¶è¯•ä¸ºæŸä¸€è¯­è¨€çš„æ–‡ä»¶)</td>
<td>x_set = 1 ==&gt; â€œ-x noneâ€</td>
</tr>
<tr>
<td>-fsanitize=addressã€-fsanitize=memory</td>
<td>asan_set = 1</td>
</tr>
<tr>
<td>FORTIFY_SOURCE</td>
<td>fortify_set = 1</td>
</tr>
<tr>
<td>-Wl,-z,defs</td>
<td>ä¸è¿½åŠ åˆ°<code>cc_params</code>ä¸­</td>
</tr>
<tr>
<td>-Wl,â€“no-undefined</td>
<td>ä¸è¿½åŠ åˆ°<code>cc_params</code>ä¸­</td>
</tr>
</tbody></table>
<ul>
<li>åé¢è¿½åŠ çš„ä¸€äº›é€‰é¡¹ä¸<code>afl-gcc</code>ç›¸ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†<code>trace pc</code>æ¨¡å¼ï¼Œ<code>AFL_INST_RATIO</code>å°†ä¸å¯ä½¿ç”¨ã€‚<code>afl-clang-fast</code>ä½¿ç”¨<code>-D</code>é€‰é¡¹å‘<code>cc_params</code>è¿½åŠ äº†ä¸€äº›éšå¼çš„<code>#define</code>ï¼Œåˆ†åˆ«æ˜¯ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>å€¼</th>
</tr>
</thead>
<tbody><tr>
<td>__AFL_HAVE_MANUAL_CONTROL=1</td>
</tr>
<tr>
<td>__AFL_COMPILER=1</td>
</tr>
<tr>
<td>FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1</td>
</tr>
<tr>
<td>__AFL_LOOP(_A)=({ static volatile char *_B __attribute__((used)); _B = (char*) â€œ##SIG_AFL_PERSISTENT##â€; __attribute__((visibility("default"))) int _L(unsigned int) __asm__("__afl_persistent_loop"); _L(_A); })</td>
</tr>
<tr>
<td>__AFL_INIT()=do  { static volatile char *_A __attribute__((used));   _A = (char*) â€œ##SIG_AFL_DEFER_FORKSRV##â€; __attribute__((visibility("default")))  void _I(void) __asm__("__afl_manual_init"); _I(); } while (0)</td>
</tr>
</tbody></table>
<ul>
<li>æœ€åï¼Œæ ¹æ®<code>bit_mode</code>å‘<code>cc_params</code>åè¿½åŠ å¯¹åº”çš„ç›®æ ‡æ–‡ä»¶ [ é»˜è®¤ä¸º <code>afl-llvm-rt.o</code>ï¼Œ32ä½ <code>afl-llvm-rt-32.o</code>ï¼Œ64ä½ <code>afl-llvm-rt-64.o</code> ]</li>
</ul>
</li>
<li><p><code>execvp()</code>ï¼šæ‰§è¡Œæ„é€ çš„å‘½ä»¤è¡Œï¼Œå³<code>cc_params</code>ã€‚è¯¥å‘½ä»¤è¡Œé€šè¿‡<code>-Xclang</code>è¿è¡Œ<strong>Pass</strong>ï¼Œç„¶åå°†<code>afl-llvm-rt.o</code>ç›®æ ‡æ–‡ä»¶é“¾æ¥åˆ°æœ€ç»ˆç”Ÿæˆçš„<code>afl-clang-fast</code>ã€‚</p>
<p><span class="github-emoji"><span>ğŸ¤”</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f914.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œ<code>afl-llvm-pass.so.cc</code>çš„ä½œç”¨æ˜¾è€Œæ˜“è§ï¼Œå°±æ˜¯æ„é€ æ‰§è¡Œ<strong>Pass</strong>æ’æ¡©çš„åŠ¨æ€é“¾æ¥åº“ï¼Œä½†ç›®æ ‡æ–‡ä»¶<code>afl-llvm-rt.o</code>çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
</li>
</ul>
</li>
</ul>
<h4 id="2-afl-llvm-pass-so-cc"><a href="#2-afl-llvm-pass-so-cc" class="headerlink" title="2. afl-llvm-pass.so.cc"></a>2. afl-llvm-pass.so.cc</h4><ul>
<li><p>ç”Ÿæˆæ‰§è¡Œæ’æ¡©<strong>Pass</strong>çš„åŠ¨æ€é“¾æ¥åº“</p>
</li>
<li><p><code>AFLCoverage::runOnModule</code>ï¼šç”¨äºæ‰§è¡Œè½¬æ¢ï¼ˆæ’æ¡©ï¼‰</p>
<p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ›å»ºä¸¤ä¸ªå…¨å±€å˜é‡ï¼š</p>
<p><code>__afl_area_ptr</code> ç”¨äºä¿å­˜å…±äº«å†…å­˜åŒºåŸŸçš„åœ°å€ï¼›<code>__afl_prev_loc</code>ç”¨äºå­˜æ”¾å‰ä¸€ä¸ªåŸºæœ¬å—IDå³ç§»ä¸€ä½çš„å€¼</p>
<p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> éå†æ‰€æœ‰åŸºæœ¬å—BBï¼š</p>
<ul>
<li>éšæœºç”Ÿæˆä¸€ä¸ªåŸºæœ¬å—IDå€¼<code>cur_loc</code></li>
<li>è½½å…¥å…¨å±€å˜é‡<code>__afl_prev_loc</code></li>
<li>è½½å…¥å…¨å±€å…±äº«å†…å­˜åŒºåŸŸæŒ‡é’ˆ<code>__afl_area_ptr</code>ï¼Œè®¡ç®—å€¼<code>cur_loc xor __afl_prev_loc</code></li>
<li>æ›´æ–°æ¯”ç‰¹ä½å›¾ï¼šå°†ä¸Šè¿°è®¡ç®—å€¼ä½œä¸ºç´¢å¼•ï¼Œåœ¨<code>__afl_area_ptr</code>ä¸­å¯»å€ï¼Œè®©å¯¹åº”çš„å­—èŠ‚å€¼+1</li>
<li>æ›´æ–°<code>__afl_prev_loc</code>çš„å€¼ï¼š<code>__afl_prev_loc = cur_loc &gt;&gt; 1</code></li>
</ul>
</li>
<li><p><code>registerAFLPass</code>ç”¨æ¥æ³¨å†Œè¯¥<strong>AFLCoverage Pass</strong>ç±»</p>
</li>
</ul>
<h4 id="3-afl-llvm-rt-o-c"><a href="#3-afl-llvm-rt-o-c" class="headerlink" title="3. afl-llvm-rt.o.c"></a>3. afl-llvm-rt.o.c</h4><ul>
<li><p>è¯¥æ–‡ä»¶çš„ä¸»è¦ä½œç”¨æœ‰ï¼š</p>
<p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åœ¨è¢«æµ‹ç›®æ ‡ç¨‹åºæ‰§è¡Œä¹‹å‰è°ƒç”¨<code>__afl_auto_init()</code>åˆå§‹åŒ–å‡½æ•°ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>__attribute__((constructor(CONST_PRIO)))</code>å…³é”®å­—ï¼Œè®©è¯¥å‡½æ•°åœ¨è¢«æµ‹ç›®æ ‡ç¨‹åºè°ƒç”¨<code>main()</code>å‡½æ•°ä¹‹å‰æ‰§è¡Œ [21]</li>
<li>è°ƒç”¨<code>__afl_manual_init()</code>å‡½æ•°ï¼š<ul>
<li><code>__afl_map_shm()</code>å‡½æ•°ç”¨æ¥è·å–å…±äº«å†…å­˜åŒºåŸŸåœ°å€</li>
<li><code>__afl_start_forkserver()</code>å‡½æ•°ç”¨æ¥å¯åŠ¨<code>fork-server</code>ï¼Œå…¶æ•´ä½“é€»è¾‘ä¸<a href="#pic13">å›¾13</a>ä¸€æ ·ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€æ³¨ï¼šè¿™é‡Œæ˜¯æ­»å¾ªç¯ï¼Œç”¨æ¥<code>fork</code>å­è¿›ç¨‹ã€‘</li>
</ul>
</li>
</ul>
<p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <strong>Persistent mode</strong></p>
<ul>
<li><p>åœ¨æºæ–‡ä»¶ä¸­è®¾ç½®<code>__AFL_LOOP(int)</code>åå¯ç”¨</p>
</li>
<li><p>å¦‚å‰æ‰€è¿°ï¼Œ<code>afl-clang-fast</code>åœ¨ç¼–è¯‘ç›®æ ‡ç¨‹åºæ—¶ï¼Œä¼šä½¿ç”¨<code>-D</code>é€‰é¡¹å¼•å…¥ä¸€ä¸ª<code>#define __AFL_LOOP(_A)</code>çš„å®å®šä¹‰ï¼Œè¯¥å®å®šä¹‰ä¼šå°†æºä»£ç ä¸­çš„<code>__AFL_LOOP(int)</code>æ›¿æ¢ä¸º<code>__afl_persistent_loop(int)</code>ã€é€šå¸¸<code>__AFL_LOOP()</code>ä¸<code>while()</code>ç»“åˆä½¿ç”¨ã€‘</p>
</li>
<li><p><code>int __afl_persistent_loop(unsigned int max_cnt)</code>ï¼š</p>
<ul>
<li>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šæ¸…ç©º<code>__afl_area_ptr</code>çš„å€¼ï¼Œå³æ¸…ç©ºè¦†ç›–ç‡è·Ÿè¸ªä½å›¾ä¿¡æ¯ï¼ˆåœ¨è¾¾åˆ°<code>__AFL_LOOP()</code>ä¹‹å‰çš„æ‰€æœ‰è¦†ç›–ç‡ä¿¡æ¯éƒ½å°†è¢«æ¸…ç©ºï¼‰ï¼Œç„¶åå°†<code>__afl_area_ptr[0]</code>ç½®ä¸º1ï¼Œ<code>__afl_prev_loc</code>ç½®ä¸º0</li>
<li>åœ¨éç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼ˆå¦‚ä¸<code>while()</code>å¾ªç¯ä¸€èµ·ä½¿ç”¨æ—¶ï¼‰ï¼Œè¯´æ˜å‰ä¸€è½®çš„è¦†ç›–ç‡ä¿¡æ¯å·²ç»ç»Ÿè®¡å®Œæˆï¼Œåœ¨è½®æ•°ä¸ä¸º0çš„æƒ…å†µä¸‹ï¼Œé¦–å…ˆ<code>raise(SIGSTOP)</code>ï¼Œè¡¨ç¤ºç¨‹åºæš‚åœï¼Œç„¶å<code>fork-server</code>çš„<code>waitpid</code>å°†ç›´æ¥è¿”å›ï¼Œç¨‹åºä»åœ¨è¿è¡Œä¸­ï¼Œç„¶åè¯¥è¦†ç›–ç‡ä¿¡æ¯å°†è¢«AFLå¤„ç†ï¼ŒåŒæ—¶ç”Ÿæˆä¸‹ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æŠ•å–‚ç»™ç›®æ ‡ç¨‹åº</li>
<li><code>fork-server</code>å†æ¥æ”¶åˆ°AFLç”Ÿæˆäº†æ–°çš„æµ‹è¯•ç”¨ä¾‹å¹¶éœ€è¦è¿è¡Œç›®æ ‡ç¨‹åºçš„æ¶ˆæ¯ä¹‹åï¼Œç”±äºå…ˆå‰çš„ç¨‹åºå¤„äºæš‚åœçŠ¶æ€ï¼Œ<code>fork-server</code>å°†ä¸ä¼š<code>fork()</code>ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼Œè€Œæ˜¯å‘ä¹‹å‰æš‚åœçš„å­è¿›ç¨‹å‘é€<code>SIGCONT</code>ï¼ˆç»§ç»­è¿è¡Œï¼‰çš„ä¿¡å·ï¼Œç„¶ååˆå›åˆ°ä¸Šä¸€æ­¥çš„å¾ªç¯ä¸­ï¼Œç›´åˆ°å¾ªç¯æ¬¡æ•°ç»“æŸ</li>
<li>å¾ªç¯æ¬¡æ•°ç»“æŸåï¼Œ<code>__afl_area_ptr</code>ä¼šé‡å®šå‘åˆ°ä¸€ä¸ªè™šå‡çš„ä½å›¾<code>__afl_area_initial</code>ä¸­ï¼Œé¿å…æ”¶é›†<code>__AFL_LOOP()</code>åé¢æ‰§è¡Œçš„ä»£ç è¦†ç›–ç‡</li>
</ul>
</li>
<li><p>ä»£ç ï¼š</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span>(__AFL_LOOP(<span class="hljs-number">1000</span>)) {<br>   	<span class="hljs-comment">// AFLåªä¼šç»Ÿè®¡è¯¥å¾ªç¯ä¸­çš„ä»£ç è¦†ç›–ç‡</span><br>    <span class="hljs-comment">// ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«ï¼Œé¿å…é¢‘ç¹çš„è°ƒç”¨ç¨‹åºçš„åˆå§‹åŒ–æ“ä½œï¼›</span><br>    <span class="hljs-comment">//      èƒ½å¤Ÿé€šè¿‡ä¸€å®šæ•°é‡è¾“å…¥çš„æŠ•å–‚ä½¿å¾—ç¨‹åºåˆ°è¾¾æŸä¸€çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥è¦†ç›–åˆ°æ›´æ·±å±‚æ¬¡çš„ä»£ç ï¼ˆè¿™å¯¹äºç½‘ç»œç¨‹åºæ¥è¯´å…·æœ‰å¥‡æ•ˆï¼‰</span><br>}<br></code></pre></td></tr></tbody></table></figure>
</li>
<li><p>æµç¨‹å›¾ï¼š</p>
<p><img src="/2022/12/27/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E5%89%96%E6%9E%90AFL%E6%8F%92%E6%A1%A9/14.png" srcset="/img/loading.gif" lazyload></p>
<center>å›¾14 persistent modeæµç¨‹å›¾</center></li>
</ul>
<p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <strong>Deferred forkserveræ¨¡å¼</strong>ï¼š</p>
<ul>
<li><p>ç”±ç¯å¢ƒå˜é‡<code>__AFL_DEFER_FORKSRV</code>æ§åˆ¶ï¼Œç”¨äºæ§åˆ¶åœ¨ä½•æ—¶å¯åŠ¨forkserverï¼Œé¿å…ä¸€äº›é•¿æ—¶é—´çš„åˆå§‹åŒ–æ“ä½œå½±å“ååé‡</p>
</li>
<li><pre><code class="c">__AFL_INIT(); // the forkserver will be raised here!

// do something ...
</code></pre>
</li>
</ul>
<p><span class="github-emoji"><span>4âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8" srcset="/img/loading.gif" lazyload aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <strong>trace_pc_guardæ¨¡å¼</strong>ï¼š</p>
<ul>
<li><p>trace_pc_guardæ¨¡å¼å¯¹æ‰€æœ‰çš„è¾¹è¿›è¡Œæ’æ¡©ï¼Œæ’æ¡©å€¼ä¸ºguard</p>
</li>
<li><p><code>__sanitizer_cov_trace_pc_guard_init(start, stop)</code>ï¼š</p>
<ul>
<li>æ›¿æ¢æ¯ä¸ª<code>trace_pc</code>å¤„çš„<code>guard</code>å€¼ï¼ˆéšæœºæ•°ï¼‰ï¼Œä¸è¿›è¡Œæ’æ¡©çš„<code>guard</code>å€¼è®¾ç½®ä¸º0</li>
</ul>
</li>
<li><p><code>__sanitizer_cov_trace_pc_guard(guard)</code>ï¼š</p>
<ul>
<li>æ›´æ–°å…±äº«å†…å­˜æ•°æ®ï¼šå¯¹æ¯”ç‰¹ä½å›¾ä¸­ç´¢å¼•ä¸º<code>guard</code>çš„å­—èŠ‚+1</li>
</ul>
</li>
</ul>
<p>trace_pc_guardç¼–è¯‘è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼š</p>
<ol>
<li><p>makefile ä¸­å®šä¹‰ <code>AFL_TRACE_PC = 1</code></p>
</li>
<li><p>å¦‚æœè¾“å‡ºå¦‚ä¸‹æ˜¾ç¤ºï¼Œåˆ™å°†afl-clang-fast.c çš„ç¬¬133è¡Œæ›¿æ¢ä¸ºï¼š<code>c_params[cc_par_cnt++] = "-sanitizer-coverage-level=0";</code> </p>
<blockquote>
<p>clang (LLVM option parsing): Unknown command line argument â€˜-sanitizer-coverage-block-threshold=0â€™.  Try: â€˜clang (LLVM option parsing) -helpâ€™<br>clang (LLVM option parsing): Did you mean â€˜-sanitizer-coverage-pc-table=0â€™?</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h2><ol>
<li><p><a target="_blank" rel="noopener" href="https://en.wikibooks.org/wiki/GNU_C_Compiler_Internals/Print_version">GNU C ç¼–è¯‘å™¨å†…éƒ¨/æ‰“å°ç‰ˆ - ç»´åŸºæ•™ç§‘ä¹¦ï¼Œå¼€æ”¾ä¸–ç•Œçš„å¼€æ”¾ä¹¦ç± (wikibooks.org)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/34502255/ast-from-c-code-with-preprocessor-directives">gcc - AST from c code with preprocessor directives - Stack Overflow</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/15800230/how-can-i-dump-an-abstract-syntax-tree-generated-by-gcc-into-a-dot-file">graphviz - How can I dump an abstract syntax tree generated by gcc into a .dot file? - Stack Overflow</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gccint/GIMPLE.html">GIMPLE (GNU Compiler Collection (GCC) Internals)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://wiki.aalto.fi/pages/viewpage.action?pageId=55374641">GCC GENERIC - Advanced course on compilers - Aalto University Wiki</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36287943/article/details/105458166">GCC - GIMPLE IR å­¦ä¹ ä¸€_zhugl0çš„åšå®¢-CSDNåšå®¢_gimple</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://wiki.aalto.fi/pages/viewpage.action?pageId=55375140">GCC RTL - Advanced course on compilers - Aalto University Wiki</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.cs.nmsu.edu/~rth/cs/cs271/notes/Compiling.html">CS271: Compiling (nmsu.edu)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch04.html">ç¬¬4ç«  å‰ç«¯ â€” Getting Started with LLVM Core Libraries æ–‡æ¡£ (getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14163208/how-to-link-c-object-files-with-ld">linker - How to link C++ object files with ld - Stack Overflow</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch05.html">ç¬¬5ç«  LLVMä¸­é—´è¡¨ç¤º â€” Getting Started with LLVM Core Libraries æ–‡æ¡£ (getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io/zh_CN/latest/ch06.html">ç¬¬6ç«  åç«¯ â€” Getting Started with LLVM Core Libraries æ–‡æ¡£ (getting-started-with-llvm-core-libraries-zh-cn.readthedocs.io)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://discourse.llvm.org/t/llc-view-dag-combine1-dags/1876/5">LLC -view-dag-combine1-dags - Beginners - LLVM Discussion Forums</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46222091/article/details/104414187">æŒ‡ä»¤è°ƒåº¦æ¦‚å¿µåŸç†ä»‹ç»_ronnie88597çš„åšå®¢-CSDNåšå®¢</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://mudongliang.github.io/2016/05/24/stack-protector.html">GCC Stack Protector options (mudongliang.github.io)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/24787769/what-are-lfb-lbb-lbe-lvl-loc-in-the-compiler-generated-assembly-code">c - What are .LFB .LBB .LBE .LVL .loc in the compiler generated assembly code - Stack Overflow</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://sourceware.org/binutils/docs-2.18/as/LNS-directives.html#LNS-directives">LNS directives - Using as (sourceware.org)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://sourceware.org/binutils/docs-2.18/as/Symbol-Names.html">Symbol Names - Using as (sourceware.org)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/gcc-mirror/gcc/blob/master/gcc/dwarf2out.cc">gcc/gcc at master Â· gcc-mirror/gcc (github.com)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://clang.llvm.org/docs/genindex.html">Index â€” Clang 16.0.0git documentation (llvm.org)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc-6.2.0/gcc/Common-Function-Attributes.html">Common Function Attributes - Using the GNU Compiler Collection (GCC)</a></p>
</li>
</ol>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95/">#æ¨¡ç³Šæµ‹è¯•</a>
      
        <a href="/tags/AFL/">#AFL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>æ·±å…¥æµ…å‡ºAFLæ’æ¡©</div>
      <div>http://bladchan.github.io/2022/12/27/æ·±å…¥æµ…å‡ºå‰–æAFLæ’æ¡©/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>bladchan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2022å¹´12æœˆ27æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/03/09/AFLplusplus%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E5%BC%82%E5%99%A8%E2%80%94%E6%BA%90%E7%A0%81%E7%BB%86%E8%8A%82/" title="AFLplusplusè‡ªå®šä¹‰å˜å¼‚å™¨â€”æºç ç»†èŠ‚">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">AFLplusplusè‡ªå®šä¹‰å˜å¼‚å™¨â€”æºç ç»†èŠ‚</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/09/27/Boofuzz%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" title="Boofuzzæºç è§£æ">
                        <span class="hidden-mobile">Boofuzzæºç è§£æ</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Chan</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Powered by Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
